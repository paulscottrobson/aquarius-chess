              	; --------------------------------------
              	; zasm: assemble "m7.asm"
              	; date: 2021-10-18 17:51:22
              	; --------------------------------------


              	; ***************************************************************************************
              	; ***************************************************************************************
              	;
              	;		Name : 		m7.asm
              	;		Author :	Paul Robson (paul@robsons.org.uk)
              	;		Date : 		15th October 2021
              	;		Purpose :	M7 Main.
              	;
              	; ***************************************************************************************
              	; ***************************************************************************************
              	
C000:         	CodeStart = 0xC000
FFFF:         	CodeEnd = 0xFFFF
              	
C000:         		.org CodeStart
              	
              	; ***************************************************************************************
              	;
              	; 									  Code Header
              	;
              	; ***************************************************************************************
              	
C000:         	start: 								
C000: 2A14C0  		ld 		hl,(StartAddress) 				; running from here
C003: E9      		jp 		(hl) 							
              	
C004:         	InformationBlock:
C004: 00C0    		.word 	start 							; +$00 base address of kernel
C006: 4AC0    		.word 	InterfaceHandler 				; +$02 Interface routine
C008: 0AC0    		.word 	DataArea 						; +$04 Data Area
              		
              		.include "kernel/data.asm" 				; data area.
              	; ***************************************************************************************
              	; ***************************************************************************************
              	;
              	;		Name : 		data.asm
              	;		Author :	Paul Robson (paul@robsons.org.uk)
              	;		Date : 		15th October 2021
              	;		Purpose :	Data 
              	;
              	; ***************************************************************************************
              	; ***************************************************************************************
              	
              	; ***************************************************************************************
              	;
              	;										Data Area
              	;
              	; ***************************************************************************************
              	
C00A:         	DataArea:
              	;
              	; 		Current state of the 3 registers
              	;
C00A:         	RegA:
C00A: 0000    		.dw 	$0000
C00C:         	RegB:
C00C: 0000    		.dw 	$0000
C00E:         	RegC:
C00E: 0000    		.dw 	$0000
              	;
              	; 		Initial Stack Pointer
              	;
C010:         	StackPointer:
C010: FF3F    		.dw 	$3FFF
              	;
              	; 		Next free code byte
              	;
C012:         	CodeNextFree:
C012: DCC6    		.dw 	FreeSpace
              	;
              	; 		Execute address for startup
              	;
C014:         	StartAddress:	
C014: 2FC0    		.dw 	Main
              	;
              	; 		Dictionary start (works down)
              	;
C016:         	DictionaryBase:
C016: 0BFE    		.dw 	DictionaryInstalledBase
              	;
              	; 		Current work trying to do
              	;
C018:         	CurrentWord:
C018: 0000    		.dw 	0
              	;
              	;		Buffer for error messages
              	;	
C01A:         	ErrorBuffer:
C01A: FFFFFFFF		.ds 	17
C01E: FF...   	
              	;
              	; 		Random number generator
              	;
C02B:         	seed1:
C02B: A713    		.dw 	$13A7
C02D:         	seed2:
C02D: DCFE    		.dw 	$FEDC
              		.include "kernel/kernel.asm"			; kernel code.	
              	; ***************************************************************************************
              	; ***************************************************************************************
              	;
              	;		Name : 		kernel.asm
              	;		Author :	Paul Robson (paul@robsons.org.uk)
              	;		Date : 		14th October 2021
              	;		Purpose :	Kernel Main Program
              	;
              	; ***************************************************************************************
              	; ***************************************************************************************
              	
              	; ***************************************************************************************
              	;
              	; 									Entry point
              	;
              	; ***************************************************************************************
              	
C02F:         	Main:
C02F: ED7B10C0			ld 		sp,(StackPointer)			; reset Stack Pointer
C033: 2100E1  			ld 		hl,testCode
C036: CDB5C0  			call 	CompileStream
              	;
              	; 		Warm Start
              	;
C039:         	WarmStart:
C039: AF      			xor 	a
C03A: 321AC0  			ld 		(ErrorBuffer),a
              	;
              	; 		Access the user interface
              	;
C03D:         	Interface:		
C03D: 211AC0  			ld 		hl,ErrorBuffer 				; point HL to Error Buffer
C040: ED7B10C0			ld 		sp,(StackPointer)			; reset Stack Pointer
C044: ED4B06C0			ld 		bc,(InformationBlock+2)
C048: C5      			push 	bc
C049: C9      			ret
              	;
              	; 		The default 'user interface'
              	;
C04A:         	InterfaceHandler:		
C04A: 11EEEE  			ld 		de,$EEEE
C04D: 01EEEE  			ld 		bc,$EEEE
C050: 76      			halt
C051: 18F7    			jr 		InterfaceHandler
              	;
              	; 		Word cannot be executed error
              	;
C053:         	WordIsCompileOnly:
C053: 3E43    			ld 		a,'C'
C055: 1802    			jr 		SetErrorBuffer
              	;
              	; 		Unknown word error
              	;
C057:         	UnknownWord:
C057: 3E3F    			ld 		a,'?'
              	;
              	; 		Report error, copy char to error buffer, then space, then current word.
              	;		
C059:         	SetErrorBuffer:
C059: 211AC0  			ld 		hl,ErrorBuffer
C05C: 77      			ld 		(hl),a
C05D: 23      			inc 	hl
C05E: 3620    			ld 		(hl),' '
C060: 23      			inc 	hl
C061: ED5B18C0			ld 		de,(CurrentWord)
C065:         	_SEBCopy:
C065: 3600    			ld 		(hl),0
C067: 1A      			ld 		a,(de)
C068: B7      			or  	a
C069: 28D2    			jr 		z,Interface
C06B: E63F    			and 	$3F
C06D: FE20    			cp 		$20
C06F: 28CC    			jr 		z,Interface
C071: EE20    			xor 	$20
C073: C620    			add 	$20
C075: FE41    			cp 		'A'
C077: 3806    			jr 		c,_SEBNotAlpha
C079: FE5B    			cp 		'Z'+1
C07B: 3002    			jr 		nc,_SEBNotAlpha
C07D: C620    			add 	$20
C07F:         	_SEBNotAlpha:
C07F: 77      			ld 		(hl),a
C080: 23      			inc 	hl
C081: 13      			inc 	de
C082: 18E1    			jr 		_SEBCopy		
              	
              			.include 	"code.asm"
              	; ***************************************************************************************
              	; ***************************************************************************************
              	;
              	;		Name : 		code.asm
              	;		Author :	Paul Robson (paul@robsons.org.uk)
              	;		Date : 		15th October 2021
              	;		Purpose :	Miscellaneous words
              	;
              	; ***************************************************************************************
              	; ***************************************************************************************
              	
              	; ***************************************************************************************
              	;
              	; 		Copy the code following (length byte first) then pop to previous level.
              	;
              	; ***************************************************************************************
              	
C084:         	CopyFollowing:
C084: E3      			ex 		(sp),hl  			 		; old HL saved on stack, HL contains length pointer
C085: C5      			push 	bc 							; save BC
C086: 46      			ld 		b,(hl) 						; get count to copy
C087:         	_CopyFollowing:
C087: 23      			inc 	hl 							; get next to copy
C088: 7E      			ld 		a,(hl)
C089: CDAAC0  			call 	CompileByte 				; and compile it.
C08C: 10F9    			djnz 	_CopyFollowing 				; copy that many bytes.	
C08E: C1      			pop 	bc 							; restore BC, HL
C08F: E1      			pop 	hl 
C090: C9      			ret 								; return to the previous level.
              	
              	; ***************************************************************************************
              	;
              	; 							Compile call to following code
              	;
              	; ***************************************************************************************
              	
C091:         	CompileCallFollowing:
C091: 3ECD    			ld 		a,$CD 						; CD is Z80 "CALL" 
C093: CDAAC0  			call 	CompileByte
C096: E1      			pop 	hl 							; get address to compile call to
C097: CD9BC0  			call 	CompileWord
C09A: C9      			ret 								; return to the previous level.
              	
              	; ***************************************************************************************
              	;
              	;									Compile HL to Code Space
              	;
              	; ***************************************************************************************
              	
C09B:         	CompileWord:
C09B: EB      			ex 		de,hl 						; DE contains value
C09C: E5      			push 	hl 							; save HL
C09D: 2A12C0  			ld 		hl,(CodeNextFree) 			; get code address
C0A0: 73      			ld 		(hl),e 						; write out
C0A1: 23      			inc 	hl 
C0A2: 72      			ld 		(hl),d
C0A3: 23      			inc 	hl
C0A4: 2212C0  			ld 		(CodeNextFree),hl 			; update code address
C0A7: E1      			pop 	hl 							; restore HL, DE
C0A8: EB      			ex 		de,hl 							
C0A9: C9      			ret
              	
              	; ***************************************************************************************
              	;
              	;									Compile A to Code Space
              	;
              	; ***************************************************************************************
              	
C0AA:         	CompileByte:
C0AA: E5      			push 	hl 							; save HL, get code address
C0AB: 2A12C0  			ld 		hl,(CodeNextFree)
C0AE: 77      			ld 		(hl),a  					; write out
C0AF: 23      			inc 	hl 							; bump & write back
C0B0: 2212C0  			ld 		(CodeNextFree),hl
C0B3: E1      			pop 	hl 	
C0B4: C9      			ret
              			.include 	"compiler.asm"
              	; ***************************************************************************************
              	; ***************************************************************************************
              	;
              	;		Name : 		compiler.asm
              	;		Author :	Paul Robson (paul@robsons.org.uk)
              	;		Date : 		16th October 2021
              	;		Purpose :	Compile stream defining executing or compiling words 
              	;
              	; ***************************************************************************************
              	; ***************************************************************************************
              	
              	; ***************************************************************************************
              	;
              	; 	Compile stream at HL, executing, compiling or defining words according to their 
              	; 	colour. This is not re-entrant, as it exits to the warm start unless it goes to 
              	; 	compile something else.
              	;
              	; ***************************************************************************************
              	
C0B5:         	CompileStream:
C0B5: 7E      			ld 		a,(hl) 						; get next character
C0B6: B7      			or 		a 							; if zero, warm start as end of stream
C0B7: CA39C0  			jp 		z,WarmStart
C0BA: 23      			inc 	hl 							; increment in case it is space
C0BB: E63F    			and 	$3F 						; check it is a coloured space.
C0BD: FE20    			cp 		$20
C0BF: 28F4    			jr 		z,CompileStream 			; if so go back
C0C1: 2B      			dec 	hl 							; undo the get, so points to the non space non zero byte.
C0C2: CDD2C0  			call 	CompileOne 					; compile word at HL.
              			;
C0C5:         	_CSNext:		
C0C5: 7E      			ld 		a,(hl) 						; advance forward to next word
C0C6: B7      			or 		a 							; if found $00 end of stream go back to CompileStream
C0C7: 28EC    			jr 		z,CompileStream
C0C9: 23      			inc 	hl
C0CA: E63F    			and 	#$3F 						; check for colour space
C0CC: FE20    			cp 		$20
C0CE: 20F5    			jr 		nz,_CSNext
C0D0: 18E3    			jr 		CompileStream 				; once found, try the next word.
              	
              	; ***************************************************************************************
              	;
              	; 						  Compile/Execute/Define word at HL.
              	;
              	; ***************************************************************************************
              	
C0D2:         	CompileOne:
C0D2: 2218C0  			ld 		(CurrentWord),hl 			; useful for debugging.
C0D5: 7E      			ld 		a,(hl) 						; get the word's colour.
C0D6: E6C0    			and 	$C0
C0D8: C8      			ret  	z 							; exit immediately if it's a comment word.
C0D9: E5      			push 	hl 							; save HL on stack
              	
C0DA: FEC0    			cp 		$C0 						; $40 and $80 , compile or execute, handled together
C0DC: 203B    			jr 		nz,_COExecuteCompile
              			;
              			; 		Create a new definition using the word at HL.
              			;
C0DE: 06FF    			ld 		b,$FF 						; we write it out backwards so go forward counting characters. We count the space so -1 here.
C0E0:         	_CDFindEnd:
C0E0: 04      			inc 	b 							; bump count
C0E1: 7E      			ld 		a,(hl) 						; get character		
C0E2: 23      			inc 	hl
C0E3: B7      			or 		a
C0E4: 2806    			jr 		z,_CDFoundEnd		 		; if zero, we're at the end
C0E6: E63F    			and 	$3F
C0E8: FE20    			cp 		$20
C0EA: 20F4    			jr 		nz,_CDFindEnd
C0EC:         	_CDFoundEnd:
              			;
              			; 		HL points one after the word end seperator, B is the count. C is the OR value for copying, which is only set 
              			; 		first time to $80
C0EC: 0E80    			ld 		c,$80 						; the copy OR value
C0EE: 2B      			dec 	hl 							; undo the get after getting the space.
C0EF:         	_CDCopyDictionary:
C0EF: 2B      			dec 	hl 							; get previous character. we are writing out backwards as we go down
C0F0: 7E      			ld 		a,(hl)
C0F1: E63F    			and 	$3F 						; colour dropped. (should be red)
C0F3: B1      			or 		c  							; OR C in, first time $80
C0F4: 0E00    			ld 		c,0 						; and next times it's only $00		
C0F6: CDDAC1  			call	CompileWriteDictionary 
C0F9: 10F4    			djnz 	_CDCopyDictionary 			; write out the whole word.
              			;
              			; 		Now create the rest of the record, the code address then type byte.
              			;
C0FB: 3A13C0  			ld 		a,(CodeNextFree+1) 			; write out code MSB then LSB
C0FE: CDDAC1  			call	CompileWriteDictionary 
C101: 3A12C0  			ld 		a,(CodeNextFree)
C104: CDDAC1  			call	CompileWriteDictionary 
C107: 3E80    			ld 		a,$80 						; then the default type byte
C109: CDDAC1  			call	CompileWriteDictionary 
              	
C10C: 3ECD    			ld 		a,$CD 						; compile CALL CompileCallFollowing into code, the default action.
C10E: CDAAC0  			call 	CompileByte 				; e.g. the word compiles a call to whatever follows it.
C111: 2191C0  			ld 		hl,CompileCallFollowing
C114: CD9BC0  			call 	CompileWord
              	
C117:         	_COPopHLExit:
C117: E1      			pop 	hl 							; restore HL and exit.
C118: C9      			ret
              	;
              	; 		Compile or execute the word at HL.
              	;
C119:         	_COExecuteCompile:
C119: E5      			push 	hl 							; save word text address
C11A: CDFCC1  			call 	SearchDictionary 			; try to find it in the dictionary
C11D: 7C      			ld 		a,h 						; was it found ?
C11E: B5      			or 		l
C11F: 284B    			jr 		z,_CECUnknown
              			;
              			; 		Word in the dictionary.
              			;
C121: D1      			pop 	de 							; get word text back in DE
C122: CB46    			bit 	0,(hl) 						; is this execute only ?
C124: 2808    			jr 		z,_CECNotCompileOnly
C126: 1A      			ld 		a,(de)  					; what are we doing with it ?
C127: E6C0    			and 	$C0  						; get colour
C129: FE80    			cp 		$80  						; if execute ?
C12B: CA53C0  			jp 		z,WordIsCompileOnly 		; then we have an error.
C12E:         	_CECNotCompileOnly:		
C12E: 1A      			ld 		a,(de) 						; get the word colour and save on the stack
C12F: E6C0    			and 	$C0
C131: F5      			push	af
              	
C132: ED5B12C0			ld 		de,(CodeNextFree) 			; save the current code position on the stack.
C136: D5      			push 	de 
              	
C137: CD66C1  			call 	_COCallRoutine 				; call the routine to compile what it does.
              	
C13A:         	_CEExecuteOrCompile:		
C13A: E1      			pop 	hl 							; restore code position at start to HL.
C13B: F1      			pop 	af 							; restore word colour.
              	
C13C: FE80    			cp 	 	$80 						; if not execute
C13E: 20D7    			jr 	 	nz,_COPopHLExit 			; then return, as we've done the compile
              	
C140: 3EC9    			ld 		a,$C9 						; this is the Z80 RET which we need to compile after the code
C142: CDAAC0  			call 	CompileByte
C145: 2212C0  			ld 		(CodeNextFree),hl 			; reset the code pointer, as we don't want to keep this executed word.
              	
C148: 1159C1  			ld 		de,_CEXContinue 			; go here on return
C14B: D5      			push 	de
C14C: E5      			push 	hl 							; go here, the newly compiled code, first, this is for the RET below
              	
C14D: 2A0AC0  			ld 		hl,(RegA) 					; load registers
C150: ED5B0CC0			ld 		de,(RegB) 					
C154: ED4B0EC0			ld 		bc,(RegC) 					
              	
C158: C9      			ret 								; execute the code, as we pushed HL - not actually returning :)
              	
C159:         	_CEXContinue:
C159: 220AC0  			ld 		(RegA),hl 					; save the registers
C15C: ED530CC0			ld 		(RegB),de
C160: ED430EC0			ld 		(RegC),bc
              	
C164: 18B1    			jr 		_COPopHLExit 				; pop HL and exit
              			;
              			; 		Call the routine to compile the code.
              			;
C166:         	_COCallRoutine:
C166: 23      			inc 	hl 							; call address into DE
C167: 5E      			ld 		e,(hl)
C168: 23      			inc 	hl
C169: 56      			ld 		d,(hl)
C16A: EB      			ex 		de,hl 						; and go there
C16B:         	_COCallHL:		
C16B: E9      			jp 		(hl)
              			;
              			; 		Word not in the dictionary. Could be a constant or a string 
              			;
C16C:         	_CECUnknown:		
C16C: E1      			pop 	hl 							; restore word address.
C16D: 7E      			ld 		a,(hl) 						; look at the first character
C16E: E63F    			and 	$3F
C170: FE22    			cp 		$22 						; is it a quote, indicating a string.
C172: 2824    			jr 		z,_CSTRProcess 
              			;
              			; 		Now it must be a constant
              			;
C174: 7E      			ld 		a,(hl) 						; push the colour on the stack
C175: E6C0    			and 	$C0
C177: F5      			push 	af
C178: CD35C2  			call 	StringToInteger 			; convert a word to a valid integer.
C17B: 7A      			ld 		a,d 						; DE = 0 if fail.
C17C: B3      			or 		e
C17D: CA57C0  			jp 		z,UnknownWord 
              			;
C180: F1      			pop 	af  
C181: FE80    			cp 		$80 						; if execute, do execute constant.
C183: 2805    			jr 		z,_CECExecuteConstant
              			;
              			; 		Compile a constant inline.
              			;
C185:         	_CECCompileConstant:		
C185: CDEEC1  			call 	CompileLoadConstant
C188: 188D    			jr 		_COPopHLExit 				; and exit
              			;
              			; 		Do the equivalent of executing a constant e.g. swap A & B n=>A
              			;
C18A:         	_CECExecuteConstant:
C18A: ED5B0AC0			ld 		de,(RegA) 					; A -> B
C18E: ED530CC0			ld 		(RegB),de
C192: 220AC0  			ld 		(RegA),hl 					; constant -> HL
C195: C317C1  			jp 		_COPopHLExit 				; and exit
              			;
              			; 		HL points to a string, prefixed by a ". Note, this is transient in execute mode.
              			;
C198:         	_CSTRProcess:
C198: 7E      			ld 		a,(hl) 						; push colour on stack
C199: E6C0    			and 	$C0
C19B: F5      			push 	af
C19C: ED5B12C0			ld 		de,(CodeNextFree) 			; save the current code position on the stack.
C1A0: D5      			push 	de 
              	
C1A1: E5      			push 	hl 							; save string address
C1A2: 3ECD    			ld 		a,$CD 						; compile CALL StringConstantHandler
C1A4: CDAAC0  			call 	CompileByte 				
C1A7: 21E5C1  			ld 		hl,StringConstantHandler
C1AA: CD9BC0  			call 	CompileWord
C1AD: E1      			pop 	hl
C1AE: 23      			inc 	hl 							; skip over the initial single quote
C1AF:         	_CSTRLoop:
C1AF: 7E      			ld 		a,(hl) 						; reached the end ? either 00 orr coloured space.
C1B0: B7      			or 		a
C1B1: 2820    			jr 		z,_CSTRDone
C1B3: E63F    			and 	$3F
C1B5: FE20    			cp 		$20
C1B7: 281A    			jr 		z,_CSTRDone		
C1B9: EE20    			xor 	$20 						; convert back to ASCII 7 bit.
C1BB: C620    			add 	$20
C1BD: FE41    			cp 		'A' 						; make lower case as default.
C1BF: 3806    			jr 		c,_CSTRNotAlpha
C1C1: FE5B    			cp 		'Z'+1
C1C3: 3002    			jr 		nc,_CSTRNotAlpha
C1C5: C620    			add 	$20
C1C7:         	_CSTRNotAlpha:		
C1C7: FE5F    			cp 		'_' 						; map _ to space
C1C9: 2002    			jr 		nz,_CSTRNotBar
C1CB: 3E20    			ld 		a,' '
C1CD:         	_CSTRNotBar:		
C1CD: CDAAC0  			call 	CompileByte  				; write out
C1D0: 23      			inc 	hl 							; next byte
C1D1: 18DC    			jr 		_CSTRLoop
C1D3:         	_CSTRDone:
C1D3: AF      			xor 	a 							; write $00 end of string
C1D4: CDAAC0  			call 	CompileByte
C1D7: C33AC1  			jp 		_CEExecuteOrCompile 		; and go do it, perhaps.		
              	
              	; ***************************************************************************************
              	;
              	; 						Write dictionary word out working downwards
              	;
              	; ***************************************************************************************
              	
C1DA:         	CompileWriteDictionary:
C1DA: E5      			push 	hl
C1DB: 2A16C0  			ld 		hl,(DictionaryBase) 		; hence pre-decrement address.
C1DE: 2B      			dec 	hl
C1DF: 77      			ld 		(hl),a
C1E0: 2216C0  			ld 		(DictionaryBase),hl
C1E3: E1      			pop 	hl
C1E4: C9      			ret
              	
              	; ***************************************************************************************
              	;
              	;					 Put in HL the ASCIIZ constant following
              	;
              	; ***************************************************************************************
              	
C1E5:         	StringConstantHandler:
C1E5: E1      			pop 	hl 							; get the return address into HL, leave on stack		
C1E6: E5      			push 	hl
C1E7:         	_SCHEnd: 									; advance HL past the string
C1E7: 7E      			ld 		a,(hl)
C1E8: 23      			inc 	hl
C1E9: B7      			or 		a
C1EA: 20FB    			jr 		nz,_SCHEnd		
C1EC: E3      			ex 		(sp),hl 					; swap them round, so HL = start and (SP) is the byte after
C1ED: C9      			ret
              	
              	; ***************************************************************************************
              	;
              	;						Compile code to load HL as a constant
              	;
              	; ***************************************************************************************
              	
C1EE:         	CompileLoadConstant:
C1EE: 3EEB    			ld 		a,$EB 						; compile EX DE,HL
C1F0: CDAAC0  			call 	CompileByte
C1F3: 3E21    			ld 		a,$21 						; LD HL,xxxxx
C1F5: CDAAC0  			call 	CompileByte
C1F8: CD9BC0  			call 	CompileWord 				; compile the number to load
C1FB: C9      			ret
              			.include 	"search.asm"
              	; ***************************************************************************************
              	; ***************************************************************************************
              	;
              	;		Name : 		find.asm
              	;		Author :	Paul Robson (paul@robsons.org.uk)
              	;		Date : 		16th October 2021
              	;		Purpose :	Search dictionary
              	;
              	; ***************************************************************************************
              	; ***************************************************************************************
              	
              	; ***************************************************************************************
              	;
              	; 		Search dictionary for word at HL, which is internal format (2+6 ended with 
              	;		(2+space or $00). On exit HL points to the type byte or $0000 if not found.
              	;
              	; ***************************************************************************************
              	
C1FC:         	SearchDictionary:
C1FC: C5      			push 	bc
C1FD: D5      			push 	de
C1FE: EB      			ex 		de,hl 						; put search string address in DE.
C1FF: 2A16C0  			ld 		hl,(DictionaryBase) 		; HL points to dictionary base.
              			;
              			; 		Compare entry at HL vs word at DE
              			;
C202:         	_SearchLoop:
C202: 44      			ld 		b,h 						; copy current being searched to BC
C203: 4D      			ld 		c,l 								
C204: 7E      			ld 		a,(hl) 						; get the type byte.
C205: B7      			or 	 	a 							; if zero, then fail as we've reached dictionary end.
C206: 2827    			jr 		z,_SDFail
              			;
C208: 23      			inc  	hl 							; point to the first character
C209: 23      			inc 	hl 							; e.g. skip type byte and call address.
C20A: 23      			inc 	hl
C20B: D5      			push 	de 							; save search string address on stack.
              			;
              			; 		Compare string at HL vs String at DE
              			;
C20C:         	_SearchCompare:
C20C: 1A      			ld 		a,(de) 						; calculate xor of two characters
C20D: AE      			xor 	(hl) 						; as we're only interested in lower 6 bits for compare
C20E: E63F    			and 	$3F 						; check lower 6 bits only.
C210: 2015    			jr 		nz,_SearchNext 				; different, go to next word.
C212: 7E      			ld 		a,(hl) 						; get dictionary byte successfully matched.
C213: 13      			inc 	de 							; advance to next.
C214: 23      			inc 	hl 		
C215: 87      			add 	a,a 						; is bit 7 in the last match, indicating the last character of the word in the dictionary ?
C216: 30F4    			jr 		nc,_SearchCompare 			; no, keep comparing
              			;
              			; 		Found the end of the word in the dictionary, HL points to the byte following, DE the character following.
              			;	 	We need to check it's the end of the word in the search text.
              			;
C218: 1A      			ld 		a,(de) 						; get the next character in the search word.
C219: D1      			pop 	de 							; having got the character, restore DE to original value.
C21A: B7      			or 		a 							; is it $00 or xx10000 (any colour space)
C21B: 2806    			jr 		z,_SDSucceed 				; if zero, we've found the word, end of buffer
C21D: E63F    			and 	$3F 
C21F: FE20    			cp 		$20
C221: 20DF    			jr 		nz,_SearchLoop 				; no it wasn't any Space so go round again. HL points to the next type byte already.
C223:         	_SDSucceed: 
C223: 60      			ld 		h,b 						; restore value saved in BC to HL, the type byte address of the found word.
C224: 69      			ld 		l,c  						; at the start, e.g. the address of the type byte.
C225: 180B    			jr 		_SDExit
              			;
              			; 		Names did not match. HL still points into the word.
              			;
C227:         	_SearchNext:
C227: 7E      			ld 		a,(hl) 						; get and bump in dictionary
C228: 23      			inc 	hl
C229: 87      			add 	a,a 						; looking for the bit 7 set indicating the end of the word
C22A: 30FB    			jr 		nc,_SearchNext  			
C22C: D1      			pop 	de 							; restore DE, the address of the input word
C22D: 18D3    			jr 		_SearchLoop 				; and try the next dictionary word.
              	;
C22F:         	_SDFail:									; not found, return zero
C22F: 210000  			ld 		hl,$0000 					
C232:         	_SDExit:
C232: D1      			pop 	de
C233: C1      			pop 	bc		
C234: C9      			ret		
              	
              	
              			.include 	"toint.asm"
              	; ***************************************************************************************
              	; ***************************************************************************************
              	;
              	;		Name : 		toint.asm
              	;		Author :	Paul Robson (paul@robsons.org.uk)
              	;		Date : 		16th October 2021
              	;		Purpose :	Convert a word to an integer.
              	;
              	; ***************************************************************************************
              	; ***************************************************************************************
              	
              	; ***************************************************************************************
              	;
              	;		Convert word to integer. Can be decimal $hexadecimal and prefixed with '-'
              	;		Result in HL, DE is non-zero if successful.
              	;
              	; ***************************************************************************************
              	
C235:         	StringToInteger:
C235: 7E      			ld 		a,(hl) 						; check for - x
C236: E63F    			and 	$3F
C238: FE2D    			cp 		'-'
C23A: 200C    			jr 		nz,_STOInt
C23C: 23      			inc 	hl 							; skip the - sign. 
C23D: CD48C2  			call 	_STOInt 					; try to convert to integer
              	
C240: 7C      			ld 		a,h 						; negate the result.
C241: 2F      			cpl 
C242: 67      			ld 		h,a
C243: 7D      			ld 		a,l
C244: 2F      			cpl
C245: 6F      			ld 		l,a
C246: 23      			inc 	hl
C247: C9      			ret
              	
C248: DDE5    	_STOInt:push 	ix 							; save IX
              			
              	
C24A: E5      			push 	hl 							; copy word address to IX
C24B: DDE1    			pop 	ix		
C24D: 01000A  			ld 		bc,10*256 					; base in B, count in C
C250: 210000  			ld 		hl,0 						; result in HL.
              			;
C253: DD7E00  			ld 		a,(ix+0) 					; is first character a '$'
C256: E63F    			and 	$3F
C258: FE24    			cp 		'$'
C25A: 2004    			jr 		nz,_STONotHex 
              			;
C25C: 0610    			ld 		b,16 						; now Base 16.
C25E: DD23    			inc 	ix 							; skip over the '$'
C260:         	_STONotHex:
              			;
              			; 		Main processing loop.
              			;		
C260:         	_STOLoop:
C260: DD7E00  			ld 		a,(ix+0) 					; get character
C263: DD23    			inc 	ix
C265: B7      			or 		a  							; check for $00 or Coloured space
C266: 282F    			jr 		z,_STOEndWord 					
C268: E63F    			and 	$3F
C26A: FE20    			cp 		$20
C26C: 2829    			jr 		z,_STOEndWord
              			;
C26E: FE3A    			cp 		'9'+1 						; if > 9 then fail
C270: 3029    			jr 		nc,_STOFail
C272: FE30    			cp 		'0'
C274: 3009    			jr 		nc,_STOOkay
C276: FE07    			cp 		6+1 						; if > F then fail
C278: 3021    			jr 		nc,_STOFail
C27A: B7      			or 		a
C27B: 281E    			jr 		z,_STOFail 					; $00 is a fail too.
C27D: C609    			add 	9 							; maps A ($01) to ($0A) etc.
C27F:         	_STOOkay:
C27F: 0C      			inc 	c 							; increment successful char count		
C280: E60F    			and 	$0F 						; make digit in range 0..15
C282: B8      			cp 		b 							; fail if >= the base
C283: 3016    			jr 		nc,_STOFail
              			;
C285: 29      			add 	hl,hl 						; HL = 2 * HL
C286: 5D      			ld 		e,l 						; DE = 2 * HL
C287: 54      			ld 		d,h		
C288: 29      			add 	hl,hl 						; HL = 4 * HL
C289: 29      			add 	hl,hl 						; HL = 8 * HL
C28A: CB60    			bit 	4,b 						; is base 16 ?
C28C: 2802    			jr 		z,_STONotHexMult
C28E: 5D      			ld 		e,l 						; if base 16 HL = DE = 8 * HL
C28F: 54      			ld 		d,h
C290:         	_STONotHexMult:
C290: 19      			add 	hl,de 						; so HL = HL * 10 or * 16 depending on B
C291: 5F      			ld 		e,a 						; put digit in DE and add
C292: 1600    			ld 		d,0
C294: 19      			add 	hl,de
C295: 18C9    			jr 		_STOLoop
              	;
C297:         	_STOEndWord:
C297: 59      			ld 		e,c 						; E is 0 if no chars, e.g. fail or #0 if chars consumed
C298: 51      			ld 		d,c 						; D the same
C299: 1806    			jr 		_STOExit 					; and exit
              	
C29B:         	_STOFail:	 								; can't do it, return DE = HL = 0	
C29B: 110000  			ld 		de,0
C29E: 210000  			ld 		hl,0
C2A1:         	_STOExit:		
C2A1: DDE1    			pop 	ix 							; restore IX and exit
C2A3: C9      			ret
              	
              			
              		
              	
              	; ***************************************************************************************
              	;
              	; 							Autogenerated Vocabulary file
              	;
              	; ***************************************************************************************
              	
              		.include 	"vocabulary/vocabulary.asm"
              	; --------------------------------------
              	;             <
              	; --------------------------------------
C2A4:         	word_1000:
C2A4: CD91C0  		call	CompileCallFollowing
C2A7: 7C      	 ld   a,h           ; check if signs different.
C2A8: AA      	 xor  d
C2A9: 87      	 add  a,a          ; CS if different
C2AA: 3004    	 jr   nc,__less_samesign
C2AC: 7A      	 ld   a,d          ; different. set CS to sign of B
C2AD: 87      	 add  a,a          ; if set (negative) B must be < A as A is +ve
C2AE: 1805    	 jr   __less_returnc
C2B0:         	__less_samesign:
C2B0: D5      	 push  de           ; save DE
C2B1: EB      	 ex   de,hl          ; -1 if B < A
C2B2: ED52    	 sbc  hl,de          ; calculate B - A , hencs CS if < (Carry clear by add a,a)
C2B4: D1      	 pop  de           ; restore DE
C2B5:         	__less_returnc:
C2B5: 3E00    	 ld   a,0          ; A 0
C2B7: DE00    	 sbc  a,0          ; A $FF if CS.
C2B9: 6F      	 ld   l,a          ; put in HL
C2BA: 67      	 ld   h,a
C2BB: C9      	 ret
              	; --------------------------------------
              	;             =
              	; --------------------------------------
C2BC:         	word_1001:
C2BC: CD91C0  		call	CompileCallFollowing
C2BF: 7C      	 ld   a,h          ; H = H ^ D
C2C0: AA      	 xor  d
C2C1: 67      	 ld   h,a
C2C2: 7D      	 ld   a,l          ; A = (L ^ E) | (H ^ D)
C2C3: AB      	 xor  e
C2C4: B4      	 or   h           ; if A == 0 they are the same.
C2C5: 210000  	 ld   hl,$0000         ; return 0 if different
C2C8: C0      	 ret  nz
C2C9: 2B      	 dec  hl           ; return -1
C2CA: C9      	 ret
              	; --------------------------------------
              	;             -
              	; --------------------------------------
C2CB:         	word_1002:
C2CB: CD91C0  		call	CompileCallFollowing
C2CE: D5      	 push  de           ; save DE
C2CF: EB      	 ex   de,hl          ; HL = B, DE = A
C2D0: AF      	 xor  a            ; clear carry
C2D1: ED52    	 sbc  hl,de          ; calculate B-A
C2D3: D1      	 pop  de           ; restore DE
C2D4: C9      	 ret
              	; --------------------------------------
              	;             +
              	; --------------------------------------
C2D5:         	word_1003:
C2D5: CD84C0  		call	CopyFollowing
C2D8: 01      		.db	endcopy_1003 - $ - 1
C2D9: 19      	 add  hl,de
C2DA:         	endcopy_1003:
              	; --------------------------------------
              	;             AND
              	; --------------------------------------
C2DA:         	word_1004:
C2DA: CD91C0  		call	CompileCallFollowing
C2DD: 7C      	 ld   a,h
C2DE: A2      	 and  d
C2DF: 67      	 ld   h,a
C2E0: 7D      	 ld   a,l
C2E1: A3      	 and  e
C2E2: 6F      	 ld   l,a
C2E3: C9      	 ret
              	; --------------------------------------
              	;             OR
              	; --------------------------------------
C2E4:         	word_1005:
C2E4: CD91C0  		call	CompileCallFollowing
C2E7: 7C      	 ld   a,h
C2E8: B2      	 or   d
C2E9: 67      	 ld   h,a
C2EA: 7D      	 ld   a,l
C2EB: B3      	 or   e
C2EC: 6F      	 ld   l,a
C2ED: C9      	 ret
              	; --------------------------------------
              	;             XOR
              	; --------------------------------------
C2EE:         	word_1006:
C2EE: CD91C0  		call	CompileCallFollowing
C2F1: 7C      	 ld   a,h
C2F2: AA      	 xor  d
C2F3: 67      	 ld   h,a
C2F4: 7D      	 ld   a,l
C2F5: AB      	 xor  e
C2F6: 6F      	 ld   l,a
C2F7: C9      	 ret
              	; --------------------------------------
              	;             /
              	; --------------------------------------
C2F8:         	word_1007:
C2F8: CD91C0  		call	CompileCallFollowing
C2FB: D5      	 push  de
C2FC: CD9AC5  	 call  DIVDivideMod16
C2FF: EB      	 ex   de,hl
C300: D1      	 pop  de
C301: C9      	 ret
              	; --------------------------------------
              	;             MOD
              	; --------------------------------------
C302:         	word_1008:
C302: CD91C0  		call	CompileCallFollowing
C305: D5      	 push  de
C306: CD9AC5  	 call  DIVDivideMod16
C309: D1      	 pop  de
C30A: C9      	 ret
              	; --------------------------------------
              	;             !
              	; --------------------------------------
C30B:         	word_1009:
C30B: CD84C0  		call	CopyFollowing
C30E: 04      		.db	endcopy_1009 - $ - 1
C30F: 73      	  ld   (hl),e
C310: 23      	  inc  hl
C311: 72      	  ld   (hl),d
C312: 2B      	  dec  hl
C313:         	endcopy_1009:
              	; --------------------------------------
              	;             @
              	; --------------------------------------
C313:         	word_1010:
C313: CD84C0  		call	CopyFollowing
C316: 04      		.db	endcopy_1010 - $ - 1
C317: 7E      	  ld   a,(hl)
C318: 23      	  inc  hl
C319: 66      	  ld  h,(hl)
C31A: 6F      	  ld  l,a
C31B:         	endcopy_1010:
              	; --------------------------------------
              	;             +!
              	; --------------------------------------
C31B:         	word_1011:
C31B: CD91C0  		call	CompileCallFollowing
C31E: 7E      	  ld   a,(hl)
C31F: 83      	  add  a,e
C320: 77      	  ld   (hl),a
C321: 23      	  inc  hl
C322: 7E      	  ld   a,(hl)
C323: 8A      	  adc  a,d
C324: 77      	  ld   (hl),a
C325: 2B      	  dec  hl
C326: C9      	  ret
              	; --------------------------------------
              	;             C!
              	; --------------------------------------
C327:         	word_1012:
C327: CD84C0  		call	CopyFollowing
C32A: 01      		.db	endcopy_1012 - $ - 1
C32B: 73      	  ld   (hl),e
C32C:         	endcopy_1012:
              	; --------------------------------------
              	;             C@
              	; --------------------------------------
C32C:         	word_1013:
C32C: CD84C0  		call	CopyFollowing
C32F: 03      		.db	endcopy_1013 - $ - 1
C330: 6E      	  ld   l,(hl)
C331: 2600    	  ld   h,0
C333:         	endcopy_1013:
              	; --------------------------------------
              	;             P@
              	; --------------------------------------
C333:         	word_1014:
C333: CD84C0  		call	CopyFollowing
C336: 04      		.db	endcopy_1014 - $ - 1
C337: ED68    	  in   l,(c)
C339: 2600    	  ld   h,0
C33B:         	endcopy_1014:
              	; --------------------------------------
              	;             P!
              	; --------------------------------------
C33B:         	word_1015:
C33B: CD84C0  		call	CopyFollowing
C33E: 02      		.db	endcopy_1015 - $ - 1
C33F: ED69    	  out  (c),l
C341:         	endcopy_1015:
              	; --------------------------------------
              	;             ,
              	; --------------------------------------
C341:         	word_1016:
C341: CD91C0  		call	CompileCallFollowing
C344: C39BC0  	  jp   CompileWord
              	; --------------------------------------
              	;             ;
              	; --------------------------------------
C347:         	word_1017:
C347: 3EC9    	  ld   a,$C9         ; compile a RET
C349: CDAAC0  	  call  CompileByte
              	  ; TODO: Check close to $E000,  so we can skip the ROM header.
C34C: C9      	  ret
              	; --------------------------------------
              	;             C,
              	; --------------------------------------
C34D:         	word_1018:
C34D: CD91C0  		call	CompileCallFollowing
C350: 7D      	  ld   a,l
C351: C3AAC0  	  jp   CompileByte
              	; --------------------------------------
              	;             COPY
              	; --------------------------------------
C354:         	word_1019:
C354: CD91C0  		call	CompileCallFollowing
C357: 78      	  ld   a,b         ; exit if C = 0
C358: B1      	  or   c
C359: C8      	  ret  z
              	
C35A: C5      	  push  bc          ; BC count
C35B: D5      	  push  de          ; DE target
C35C: E5      	  push  hl          ; HL source
              	
C35D: AF      	  xor  a          ; Clear C
C35E: ED52    	  sbc  hl,de         ; check overlap ?
C360: 300B    	  jr   nc,__copy_gt_count      ; if source after target
C362: 19      	  add  hl,de         ; undo subtract
              	
C363: 09      	  add  hl,bc         ; add count to HL + DE
C364: EB      	  ex   de,hl
C365: 09      	  add  hl,bc
C366: EB      	  ex   de,hl
C367: 1B      	  dec  de          ; dec them, so now at the last byte to copy
C368: 2B      	  dec  hl
C369: EDB8    	  lddr           ; do it backwards
C36B: 1803    	  jr   __copy_exit
              	
C36D:         	__copy_gt_count:
C36D: 19      	  add  hl,de         ; undo subtract
C36E: EDB0    	  ldir          ; do the copy
C370:         	__copy_exit:
C370: E1      	  pop  hl          ; restore registers
C371: D1      	  pop  de
C372: C1      	  pop  bc
C373: C9      	  ret
              	; --------------------------------------
              	;             FILL
              	; --------------------------------------
C374:         	word_1020:
C374: CD91C0  		call	CompileCallFollowing
C377: 78      	  ld   a,b         ; exit if C = 0
C378: B1      	  or   c
C379: C8      	  ret  z
              	
C37A: C5      	  push  bc          ; BC count
C37B: D5      	  push  de          ; DE target, L byte
C37C:         	__fill_loop:
C37C: 7D      	  ld   a,l         ; copy a byte
C37D: 12      	  ld   (de),a
C37E: 13      	  inc  de          ; bump pointer
C37F: 0B      	  dec  bc          ; dec counter and loop
C380: 78      	  ld   a,b
C381: B1      	  or   c
C382: 20F8    	  jr   nz,__fill_loop
C384: D1      	  pop  de          ; restore
C385: C1      	  pop  bc
C386: C9      	  ret
              	; --------------------------------------
              	;             HALT
              	; --------------------------------------
C387:         	word_1021:
C387: CD91C0  		call	CompileCallFollowing
C38A:         	__halt_loop:
C38A: F3      	  di
C38B: 76      	  halt
C38C: 18FC    	  jr   __halt_loop
              	; --------------------------------------
              	;             BREAK
              	; --------------------------------------
C38E:         	word_1022:
C38E: CD84C0  		call	CopyFollowing
C391: 01      		.db	endcopy_1022 - $ - 1
C392: 76      	  db   $76
C393:         	endcopy_1022:
              	; --------------------------------------
              	;             *
              	; --------------------------------------
C393:         	word_1023:
C393: CD91C0  		call	CompileCallFollowing
C396: C3C5C5  	 jp   MULTMultiply16
              	; --------------------------------------
              	;             SWAP
              	; --------------------------------------
C399:         	word_1024:
C399: CD84C0  		call	CopyFollowing
C39C: 01      		.db	endcopy_1024 - $ - 1
C39D: EB      	  ex   de,hl
C39E:         	endcopy_1024:
              	; --------------------------------------
              	;             A>B
              	; --------------------------------------
C39E:         	word_1025:
C39E: CD84C0  		call	CopyFollowing
C3A1: 02      		.db	endcopy_1025 - $ - 1
C3A2: 54      	  ld   d,h
C3A3: 5D      	  ld   e,l
C3A4:         	endcopy_1025:
              	; --------------------------------------
              	;             A>C
              	; --------------------------------------
C3A4:         	word_1026:
C3A4: CD84C0  		call	CopyFollowing
C3A7: 02      		.db	endcopy_1026 - $ - 1
C3A8: 44      	  ld   b,h
C3A9: 4D      	  ld   c,l
C3AA:         	endcopy_1026:
              	; --------------------------------------
              	;             B>A
              	; --------------------------------------
C3AA:         	word_1027:
C3AA: CD84C0  		call	CopyFollowing
C3AD: 02      		.db	endcopy_1027 - $ - 1
C3AE: 62      	  ld   h,d
C3AF: 6B      	  ld   l,e
C3B0:         	endcopy_1027:
              	; --------------------------------------
              	;             B>C
              	; --------------------------------------
C3B0:         	word_1028:
C3B0: CD84C0  		call	CopyFollowing
C3B3: 02      		.db	endcopy_1028 - $ - 1
C3B4: 42      	  ld   b,d
C3B5: 4B      	  ld   c,e
C3B6:         	endcopy_1028:
              	; --------------------------------------
              	;             C>A
              	; --------------------------------------
C3B6:         	word_1029:
C3B6: CD84C0  		call	CopyFollowing
C3B9: 02      		.db	endcopy_1029 - $ - 1
C3BA: 60      	  ld   h,b
C3BB: 69      	  ld   l,c
C3BC:         	endcopy_1029:
              	; --------------------------------------
              	;             C>B
              	; --------------------------------------
C3BC:         	word_1030:
C3BC: CD84C0  		call	CopyFollowing
C3BF: 02      		.db	endcopy_1030 - $ - 1
C3C0: 50      	  ld   d,b
C3C1: 59      	  ld   e,c
C3C2:         	endcopy_1030:
              	; --------------------------------------
              	;             PUSH
              	; --------------------------------------
C3C2:         	word_1031:
C3C2: CD84C0  		call	CopyFollowing
C3C5: 01      		.db	endcopy_1031 - $ - 1
C3C6: E5      	 push  hl
C3C7:         	endcopy_1031:
              	; --------------------------------------
              	;             POP
              	; --------------------------------------
C3C7:         	word_1032:
C3C7: CD84C0  		call	CopyFollowing
C3CA: 02      		.db	endcopy_1032 - $ - 1
C3CB: EB      	 ex   de,hl
C3CC: E1      	 pop  hl
C3CD:         	endcopy_1032:
              	; --------------------------------------
              	;             A>R
              	; --------------------------------------
C3CD:         	word_1033:
C3CD: CD84C0  		call	CopyFollowing
C3D0: 01      		.db	endcopy_1033 - $ - 1
C3D1: E5      	 push  hl
C3D2:         	endcopy_1033:
              	; --------------------------------------
              	;             R>A
              	; --------------------------------------
C3D2:         	word_1034:
C3D2: CD84C0  		call	CopyFollowing
C3D5: 01      		.db	endcopy_1034 - $ - 1
C3D6: E1      	 pop  hl
C3D7:         	endcopy_1034:
              	; --------------------------------------
              	;             B>R
              	; --------------------------------------
C3D7:         	word_1035:
C3D7: CD84C0  		call	CopyFollowing
C3DA: 01      		.db	endcopy_1035 - $ - 1
C3DB: D5      	 push  de
C3DC:         	endcopy_1035:
              	; --------------------------------------
              	;             R>B
              	; --------------------------------------
C3DC:         	word_1036:
C3DC: CD84C0  		call	CopyFollowing
C3DF: 01      		.db	endcopy_1036 - $ - 1
C3E0: D1      	 pop  de
C3E1:         	endcopy_1036:
              	; --------------------------------------
              	;             C>R
              	; --------------------------------------
C3E1:         	word_1037:
C3E1: CD84C0  		call	CopyFollowing
C3E4: 01      		.db	endcopy_1037 - $ - 1
C3E5: C5      	 push  bc
C3E6:         	endcopy_1037:
              	; --------------------------------------
              	;             R>C
              	; --------------------------------------
C3E6:         	word_1038:
C3E6: CD84C0  		call	CopyFollowing
C3E9: 01      		.db	endcopy_1038 - $ - 1
C3EA: C1      	 pop  bc
C3EB:         	endcopy_1038:
              	; --------------------------------------
              	;             AB>R
              	; --------------------------------------
C3EB:         	word_1039:
C3EB: CD84C0  		call	CopyFollowing
C3EE: 02      		.db	endcopy_1039 - $ - 1
C3EF: D5      	 push  de
C3F0: E5      	 push  hl
C3F1:         	endcopy_1039:
              	; --------------------------------------
              	;             R>AB
              	; --------------------------------------
C3F1:         	word_1040:
C3F1: CD84C0  		call	CopyFollowing
C3F4: 02      		.db	endcopy_1040 - $ - 1
C3F5: E1      	 pop  hl
C3F6: D1      	 pop  de
C3F7:         	endcopy_1040:
              	; --------------------------------------
              	;             ABC>R
              	; --------------------------------------
C3F7:         	word_1041:
C3F7: CD84C0  		call	CopyFollowing
C3FA: 03      		.db	endcopy_1041 - $ - 1
C3FB: C5      	 push  bc
C3FC: D5      	 push  de
C3FD: E5      	 push  hl
C3FE:         	endcopy_1041:
              	; --------------------------------------
              	;             R>ABC
              	; --------------------------------------
C3FE:         	word_1042:
C3FE: CD84C0  		call	CopyFollowing
C401: 03      		.db	endcopy_1042 - $ - 1
C402: E1      	 pop  hl
C403: D1      	 pop  de
C404: C1      	 pop  bc
C405:         	endcopy_1042:
              	; --------------------------------------
              	;             H
              	; --------------------------------------
C405:         	word_1043:
C405: CD84C0  		call	CopyFollowing
C408: 04      		.db	endcopy_1043 - $ - 1
C409: EB      	  ex  de,hl
C40A: 2112C0  	  ld  hl,CodeNextFree
C40D:         	endcopy_1043:
              	; --------------------------------------
              	;             $SYSTEM
              	; --------------------------------------
C40D:         	word_1044:
C40D: CD84C0  		call	CopyFollowing
C410: 04      		.db	endcopy_1044 - $ - 1
C411: EB      	  ex  de,hl
C412: 2104C0  	  ld  hl,InformationBlock
C415:         	endcopy_1044:
              	; --------------------------------------
              	;             $DICTIONARY
              	; --------------------------------------
C415:         	word_1045:
C415: CD84C0  		call	CopyFollowing
C418: 04      		.db	endcopy_1045 - $ - 1
C419: EB      	  ex  de,hl
C41A: 2A16C0  	  ld  hl,(DictionaryBase)
C41D:         	endcopy_1045:
              	; --------------------------------------
              	;             WARM.START
              	; --------------------------------------
C41D:         	word_1046:
C41D: CD91C0  		call	CompileCallFollowing
C420: C339C0  	  jp   WarmStart
              	; --------------------------------------
              	;             REPORT.ERROR
              	; --------------------------------------
C423:         	word_1047:
C423: CD91C0  		call	CompileCallFollowing
C426: C33DC0  	  jp   Interface
              	; --------------------------------------
              	;             $COMPILER
              	; --------------------------------------
C429:         	word_1048:
C429: CD91C0  		call	CompileCallFollowing
C42C: C3B5C0  	  jp   CompileStream
              	; --------------------------------------
              	;             CONSTANT
              	; --------------------------------------
C42F:         	word_1049:
C42F: 2A12C0  	  ld   hl,(CodeNextFree)    ; fix up definition to remove call address.
C432: 2B      	  dec  hl
C433: 2B      	  dec  hl
C434: 2212C0  	  ld   (CodeNextFree),hl    ; keeping the CALL opcode.
              	  ;
C437: 21DFC5  	  ld   hl,ConstantHandler    ; make it CALL ConstantHandler
C43A: CD9BC0  	  call  CompileWord
C43D: 2A0AC0  	  ld   hl,(RegA)     ; and put the word in after.
C440: CD9BC0  	  call  CompileWord
C443: C9      	  ret
              	; --------------------------------------
              	;             VARIABLE
              	; --------------------------------------
C444:         	word_1050:
C444: 2A12C0  	  ld   hl,(CodeNextFree)    ; fix up definition to remove call address.
C447: 2B      	  dec  hl
C448: 2B      	  dec  hl
C449: 2212C0  	  ld   (CodeNextFree),hl    ; keeping the CALL opcode.
              	  ;
C44C: 21F2C5  	  ld   hl,VariableHandler    ; make it CALL VariableHandler
C44F: CD9BC0  	  call  CompileWord
C452: 210000  	  ld   hl,$0000     ; initialise to zero.
C455: CD9BC0  	  call  CompileWord
C458: C9      	  ret
              	; --------------------------------------
              	;             DATA
              	; --------------------------------------
C459:         	word_1051:
C459: 2A12C0  	  ld   hl,(CodeNextFree)    ; fix up definition to remove call address.
C45C: 2B      	  dec  hl
C45D: 2B      	  dec  hl
C45E: 2212C0  	  ld   (CodeNextFree),hl    ; keeping the CALL opcode.
              	  ;
C461: 21F2C5  	  ld   hl,VariableHandler    ; make it CALL VariableHandler
C464: CD9BC0  	  call  CompileWord
C467: C9      	  ret
              	; --------------------------------------
              	;             ARRAY
              	; --------------------------------------
C468:         	word_1052:
C468: 2A12C0  	  ld   hl,(CodeNextFree)    ; fix up definition to remove call address.
C46B: 2B      	  dec  hl
C46C: 2B      	  dec  hl
C46D: 2212C0  	  ld   (CodeNextFree),hl    ; keeping the CALL opcode.
              	  ;
C470: 21F2C5  	  ld   hl,VariableHandler    ; make it CALL VariableHandler
C473: CD9BC0  	  call  CompileWord
              	
C476: 2A0AC0  	  ld   hl,(RegA)     ; initialise to zero.
C479:         	_MakeArray:
C479: 7C      	  ld   a,h
C47A: B5      	  or   l
C47B: C8      	  ret  z
C47C: 2B      	  dec  hl
C47D: AF      	  xor  a
C47E: CDAAC0  	  call  CompileByte
C481: 18F6    	  jr   _MakeArray
C483: C9      	  ret
              	; --------------------------------------
              	;             ADDRESS.OF
              	; --------------------------------------
C484:         	word_1053:
C484: D5      	  push  de
C485: E5      	  push  hl
C486: 2A12C0  	  ld   hl,(CodeNextFree)    ; get previous code address
C489: 2B      	  dec  hl
C48A: 56      	  ld   d,(hl)
C48B: 2B      	  dec  hl
C48C: 5E      	  ld   e,(hl)
C48D: 2B      	  dec  hl
C48E: 2212C0  	  ld   (CodeNextFree),hl    ; we've removed the word, address is in DE
C491: EB      	  ex   de,hl
C492: CDEEC1  	  call  CompileLoadConstant
C495: E1      	  pop  hl
C496: D1      	  pop  de
C497: C9      	  ret
              	; --------------------------------------
              	;             !!
              	; --------------------------------------
C498:         	word_1054:
C498: 2A12C0  	  ld   hl,(CodeNextFree)    ; we save one byte.
C49B: 2B      	  dec  hl
C49C: 2212C0  	  ld   (CodeNextFree),hl
              	  ;
C49F: 46      	  ld   b,(hl)
C4A0: 2B      	  dec  hl
C4A1: 4E      	  ld   c,(hl)
C4A2: 70      	  ld   (hl),b
C4A3: 2B      	  dec  hl
C4A4: 71      	  ld   (hl),c
C4A5: 2B      	  dec  hl
C4A6: 3622    	  ld   (hl),$22
C4A8: C9      	  ret
              	; --------------------------------------
              	;             @@
              	; --------------------------------------
C4A9:         	word_1055:
C4A9: 2A12C0  	  ld   hl,(CodeNextFree)    ; we save one byte.
              	  ;
C4AC: 2B      	  dec  hl
C4AD: 2B      	  dec  hl
C4AE: 2B      	  dec  hl
C4AF: 362A    	  ld   (hl),$2A
C4B1: C9      	  ret
              	; --------------------------------------
              	;             ---
              	; --------------------------------------
C4B2:         	word_1056:
C4B2: CD84C0  		call	CopyFollowing
C4B5: 02      		.db	endcopy_1056 - $ - 1
C4B6: 2B      	  dec  hl
C4B7: 2B      	  dec  hl
C4B8:         	endcopy_1056:
              	; --------------------------------------
              	;             --
              	; --------------------------------------
C4B8:         	word_1057:
C4B8: CD84C0  		call	CopyFollowing
C4BB: 01      		.db	endcopy_1057 - $ - 1
C4BC: 2B      	  dec  hl
C4BD:         	endcopy_1057:
              	; --------------------------------------
              	;             ++
              	; --------------------------------------
C4BD:         	word_1058:
C4BD: CD84C0  		call	CopyFollowing
C4C0: 01      		.db	endcopy_1058 - $ - 1
C4C1: 23      	  inc  hl
C4C2:         	endcopy_1058:
              	; --------------------------------------
              	;             +++
              	; --------------------------------------
C4C2:         	word_1059:
C4C2: CD84C0  		call	CopyFollowing
C4C5: 02      		.db	endcopy_1059 - $ - 1
C4C6: 23      	  inc  hl
C4C7: 23      	  inc  hl
C4C8:         	endcopy_1059:
              	; --------------------------------------
              	;             0-
              	; --------------------------------------
C4C8:         	word_1060:
C4C8: CD91C0  		call	CompileCallFollowing
C4CB:         	__negate:
C4CB: 7C      	  ld   a,h
C4CC: 2F      	  cpl
C4CD: 67      	  ld   h,a
C4CE: 7D      	  ld   a,l
C4CF: 2F      	  cpl
C4D0: 6F      	  ld   l,a
C4D1: 23      	  inc  hl
C4D2: C9      	  ret
              	; --------------------------------------
              	;             0<
              	; --------------------------------------
C4D3:         	word_1061:
C4D3: CD91C0  		call	CompileCallFollowing
C4D6: CB7C    	  bit  7,h
C4D8: 210000  	  ld   hl,$0000
C4DB: C8      	  ret  z
C4DC: 2B      	  dec  hl
C4DD: C9      	  ret
              	; --------------------------------------
              	;             0=
              	; --------------------------------------
C4DE:         	word_1062:
C4DE: CD91C0  		call	CompileCallFollowing
C4E1: 7C      	  ld   a,h
C4E2: B5      	  or   l
C4E3: 210000  	  ld   hl,$0000
C4E6: C0      	  ret  nz
C4E7: 2B      	  dec  hl
C4E8: C9      	  ret
              	; --------------------------------------
              	;             2*
              	; --------------------------------------
C4E9:         	word_1063:
C4E9: CD84C0  		call	CopyFollowing
C4EC: 01      		.db	endcopy_1063 - $ - 1
C4ED: 29      	  add  hl,hl
C4EE:         	endcopy_1063:
              	; --------------------------------------
              	;             4*
              	; --------------------------------------
C4EE:         	word_1064:
C4EE: CD84C0  		call	CopyFollowing
C4F1: 02      		.db	endcopy_1064 - $ - 1
C4F2: 29      	  add  hl,hl
C4F3: 29      	  add  hl,hl
C4F4:         	endcopy_1064:
              	; --------------------------------------
              	;             8*
              	; --------------------------------------
C4F4:         	word_1065:
C4F4: CD84C0  		call	CopyFollowing
C4F7: 03      		.db	endcopy_1065 - $ - 1
C4F8: 29      	  add  hl,hl
C4F9: 29      	  add  hl,hl
C4FA: 29      	  add  hl,hl
C4FB:         	endcopy_1065:
              	; --------------------------------------
              	;             16*
              	; --------------------------------------
C4FB:         	word_1066:
C4FB: CD84C0  		call	CopyFollowing
C4FE: 04      		.db	endcopy_1066 - $ - 1
C4FF: 29      	  add  hl,hl
C500: 29      	  add  hl,hl
C501: 29      	  add  hl,hl
C502: 29      	  add  hl,hl
C503:         	endcopy_1066:
              	; --------------------------------------
              	;             2/
              	; --------------------------------------
C503:         	word_1067:
C503: CD84C0  		call	CopyFollowing
C506: 04      		.db	endcopy_1067 - $ - 1
C507: CB2C    	  sra  h
C509: CB1D    	  rr   l
C50B:         	endcopy_1067:
              	; --------------------------------------
              	;             4/
              	; --------------------------------------
C50B:         	word_1068:
C50B: CD84C0  		call	CopyFollowing
C50E: 08      		.db	endcopy_1068 - $ - 1
C50F: CB2C    	  sra  h
C511: CB1D    	  rr   l
C513: CB2C    	  sra  h
C515: CB1D    	  rr   l
C517:         	endcopy_1068:
              	; --------------------------------------
              	;             ABS
              	; --------------------------------------
C517:         	word_1069:
C517: CD91C0  		call	CompileCallFollowing
C51A: CB7C    	  bit  7,h
C51C: C8      	  ret  z
C51D: C3CBC4  	  jp   __negate
              	; --------------------------------------
              	;             BSWAP
              	; --------------------------------------
C520:         	word_1070:
C520: CD84C0  		call	CopyFollowing
C523: 03      		.db	endcopy_1070 - $ - 1
C524: 7D      	  ld   a,l
C525: 6C      	  ld   l,h
C526: 67      	  ld   h,a
C527:         	endcopy_1070:
              	; --------------------------------------
              	;             NOT
              	; --------------------------------------
C527:         	word_1071:
C527: CD91C0  		call	CompileCallFollowing
C52A: 7C      	  ld   a,h
C52B: 2F      	  cpl
C52C: 67      	  ld   h,a
C52D: 7D      	  ld   a,l
C52E: 2F      	  cpl
C52F: 6F      	  ld   l,a
C530: C9      	  ret
              	; --------------------------------------
              	;             RANDOM
              	; --------------------------------------
C531:         	word_1072:
C531: CD91C0  		call	CompileCallFollowing
C534: EB      	 ex   de,hl
C535: C5      	 push  bc
C536: 2A2BC0  	    ld   hl,(seed1)
C539: 44      	    ld   b,h
C53A: 4D      	    ld   c,l
C53B: 29      	    add  hl,hl
C53C: 29      	    add  hl,hl
C53D: 2C      	    inc  l
C53E: 09      	    add  hl,bc
C53F: 222BC0  	    ld   (seed1),hl
C542: 2A2DC0  	    ld   hl,(seed2)
C545: 29      	    add  hl,hl
C546: 9F      	    sbc  a,a
C547: E62D    	    and  %00101101
C549: AD      	    xor  l
C54A: 6F      	    ld   l,a
C54B: 222DC0  	    ld   (seed2),hl
C54E: 09      	    add  hl,bc
C54F: C1      	    pop  bc
C550: C9      	    ret
              	; --------------------------------------
              	;             IM.DRAW
              	; --------------------------------------
C551:         	word_1073:
C551: CD91C0  		call	CompileCallFollowing
C554: C5      	  push  bc
C555: D5      	  push  de
C556: E5      	  push  hl
              	
C557: 65      	  ld   h,l
C558: 6B      	  ld   l,e
              	
C559: 59      	  ld   e,c
C55A: 50      	  ld   d,b
              	
C55B: 010000  	  ld   bc,$0000
              	
C55E: CD17C6  	  call  ImageDraw
C561: E1      	  pop  hl
C562: D1      	  pop  de
C563: C1      	  pop  bc
C564: C9      	  ret
              	; --------------------------------------
              	;             SG.DRAW
              	; --------------------------------------
C565:         	word_1074:
C565: CD91C0  		call	CompileCallFollowing
C568: C5      	  push  bc
C569: D5      	  push  de
C56A: E5      	  push  hl
              	
              	
C56B: 4E      	  ld   c,(hl)    ; count in BC
C56C: 23      	  inc  hl
C56D: 46      	  ld   b,(hl)
C56E: 23      	  inc  hl
              	
C56F:         	_SGDLoop:
C56F: CD68C6  	  call  CopySpriteData
C572: CD93C6  	  call  DrawOneSprite
C575: 23      	  inc  hl
C576: 23      	  inc  hl
C577: 0B      	  dec  bc
C578: 78      	  ld   a,b
C579: B1      	  or   c
C57A: 20F3    	  jr   nz,_SGDLoop
              	
C57C: E1      	  pop  hl
C57D: D1      	  pop  de
C57E: C1      	  pop  bc
C57F: C9      	  ret
              	; --------------------------------------
              	;             SG.ERASE
              	; --------------------------------------
C580:         	word_1075:
C580: CD91C0  		call	CompileCallFollowing
C583: C5      	  push  bc
C584: D5      	  push  de
C585: E5      	  push  hl
              	
              	
C586: 4E      	  ld   c,(hl)    ; count in BC
C587: 23      	  inc  hl
C588: 46      	  ld   b,(hl)
C589: 2B      	  dec  hl
              	
C58A: 09      	  add  hl,bc    ; advance to last.
C58B: 09      	  add  hl,bc
C58C:         	_SEDLoop:
C58C: CDB7C6  	  call  EraseOneSprite
C58F: 2B      	  dec  hl
C590: 2B      	  dec  hl
C591: 0B      	  dec  bc
C592: 78      	  ld   a,b
C593: B1      	  or   c
C594: 20F6    	  jr   nz,_SEDLoop
              	
C596: E1      	  pop  hl
C597: D1      	  pop  de
C598: C1      	  pop  bc
C599: C9      	  ret
              	
              	
              	
C59A:         	DIVDivideMod16:
C59A: C5      	 push  bc
C59B: 42      	 ld   b,d     ; DE
C59C: 4B      	 ld   c,e
C59D: EB      	 ex   de,hl
C59E: 210000  	 ld   hl,0
C5A1: 78      	 ld   a,b
C5A2: 0608    	 ld   b,8
C5A4:         	Div16_Loop1:
C5A4: 17      	 rla
C5A5: ED6A    	 adc  hl,hl
C5A7: ED52    	 sbc  hl,de
C5A9: 3001    	 jr   nc,Div16_NoAdd1
C5AB: 19      	 add  hl,de
C5AC:         	Div16_NoAdd1:
C5AC: 10F6    	 djnz  Div16_Loop1
C5AE: 17      	 rla
C5AF: 2F      	 cpl
C5B0: 47      	 ld   b,a
C5B1: 79      	 ld   a,c
C5B2: 48      	 ld   c,b
C5B3: 0608    	 ld   b,8
C5B5:         	Div16_Loop2:
C5B5: 17      	 rla
C5B6: ED6A    	 adc  hl,hl
C5B8: ED52    	 sbc  hl,de
C5BA: 3001    	 jr   nc,Div16_NoAdd2
C5BC: 19      	 add  hl,de
C5BD:         	Div16_NoAdd2:
C5BD: 10F6    	 djnz  Div16_Loop2
C5BF: 17      	 rla
C5C0: 2F      	 cpl
C5C1: 51      	 ld   d,c
C5C2: 5F      	 ld   e,a
C5C3: C1      	 pop  bc
C5C4: C9      	 ret
C5C5:         	MULTMultiply16:
C5C5: C5      	  push  bc
C5C6: D5      	  push  de
C5C7: 44      	  ld   b,h        ; get multipliers in DE/BC
C5C8: 4D      	  ld   c,l
C5C9: 210000  	  ld   hl,0        ; zero total
C5CC:         	__Core__Mult_Loop:
C5CC: CB41    	  bit  0,c        ; lsb of shifter is non-zero
C5CE: 2801    	  jr   z,__Core__Mult_Shift
C5D0: 19      	  add  hl,de        ; add adder to total
C5D1:         	__Core__Mult_Shift:
C5D1: CB38    	  srl  b         ; shift BC right.
C5D3: CB19    	  rr   c
C5D5: EB      	  ex   de,hl        ; shift DE left
C5D6: 29      	  add  hl,hl
C5D7: EB      	  ex   de,hl
C5D8: 78      	  ld   a,b        ; loop back if BC is nonzero
C5D9: B1      	  or   c
C5DA: 20F0    	  jr   nz,__Core__Mult_Loop
C5DC: D1      	  pop  de
C5DD: C1      	  pop  bc
C5DE: C9      	  ret
C5DF:         	ConstantHandler:
C5DF: 3EEB    	  ld   a,0xEB       ; compile ex de,hl
C5E1: CDAAC0  	  call  CompileByte
C5E4: 3E21    	  ld   a,0x21       ; compile ld hl,
C5E6: CDAAC0  	  call  CompileByte
C5E9: E1      	  pop  hl        ; address of word to compile
C5EA: 7E      	  ld   a,(hl)
C5EB: 23      	  inc  hl
C5EC: 66      	  ld   h,(hl)
C5ED: 6F      	  ld   l,a
C5EE: CD9BC0  	  call  CompileWord     ; compile that word.
C5F1: C9      	  ret
              	
              	
C5F2:         	VariableHandler:
C5F2: 3EEB    	  ld   a,0xEB       ; compile ex de,hl
C5F4: CDAAC0  	  call  CompileByte
C5F7: 3E21    	  ld   a,0x21       ; compile ld hl,
C5F9: CDAAC0  	  call  CompileByte
C5FC: E1      	  pop  hl        ; address of word to compile
C5FD: CD9BC0  	  call  CompileWord     ; compile that word.
C600: C9      	  ret
              	
              	
C601:         	FixAccessCodeWrite:
C601: 3E2A    	  ld   a,0x2A       ; LD HL,(xxxx)
C603: 3002    	  jr   nc,_FACIsRead     ; use Carry to decide what to update
C605: 3E22    	  ld   a,0x22
C607:         	_FACIsRead:
              	  ;
C607: 2A12C0  	  ld   hl,(CodeNextFree)    ; we save one byte.
C60A: 2B      	  dec  hl
C60B: 2212C0  	  ld   (CodeNextFree),hl
              	  ;
C60E: 46      	  ld   b,(hl)
C60F: 2B      	  dec  hl
C610: 4E      	  ld   c,(hl)
C611: 70      	  ld   (hl),b
C612: 2B      	  dec  hl
C613: 71      	  ld   (hl),c
C614: 2B      	  dec  hl
C615: 77      	  ld   (hl),a
C616: C9      	  ret
C617:         	ImageDraw:
C617: 7D      	  ld  a,l       ; check in range 0..39 0..23
C618: FE18    	  cp   24
C61A: D0      	  ret  nc
C61B: 7C      	  ld   a,h
C61C: FE28    	  cp   40
C61E: D0      	  ret  nc
              	
C61F: CD52C6  	  call  IDCalculatePos     ; calculate position on screen -> HL
              	
C622: 1A      	  ld   a,(de)       ; get X,Y size into A
C623: 13      	  inc  de        ; advance into graphic data
              	
C624: 02      	  ld   (bc),a       ; write size out to save, so it's a graphic
C625: 03      	  inc  bc        ; in its own right.
              	  ;
              	  ;   Draw one line A is size, HL screen pos, DE gfx data, BC store.
              	  ;
C626:         	_IDOuter:
C626: F5      	  push  af        ; save height counter.
C627: E5      	  push  hl        ; save screen position, start of line
C628: E60F    	  and  $0F       ; make A a horizontal counter, e.g. 0..15
C62A: 2810    	  jr   z,_IDDoneBoth     ; width zero, nothing to do.
C62C:         	_IDInner:
              	  ;
              	  ;   Save/Copy one byte, go through this twice, once for colour RAM $3000-$33FF and once
              	  ;   for char RAM $3400-$37FF
              	  ;
C62C: F5      	  push  af        ; save A
              	
C62D: 7E      	  ld   a,(hl)       ; get and save old value
C62E: 02      	  ld   (bc),a
C62F: 03      	  inc  bc
              	
C630: 1A      	  ld   a,(de)       ; copy out new value
C631: 77      	  ld   (hl),a
C632: 13      	  inc  de
              	
C633: F1      	  pop  af        ; restore A
              	
C634: CB54    	  bit  2,h       ; are we in $34xx e.g. have just written to colour RAM
C636: 2004    	  jr   nz,_IDDoneBoth     ; if so we've done both.
C638: CBD4    	  set  2,h       ; otherwise do the colour RAM copy
C63A: 18F0    	  jr   _IDInner
              	  ;
              	  ;   Done one character, now advance one right.
              	  ;
C63C:         	_IDDoneBoth:
C63C: CB94    	  res  2,h       ; back to character RAM.
C63E: 23      	  inc  hl        ; next character to the right
C63F: 3D      	  dec  a        ; done the lot
C640: 20EA    	  jr   nz,_IDInner      ; no, go back.
              	
C642: E1      	  pop  hl        ; restore start of line
C643: 7D      	  ld   a,l       ; go down one line
C644: C628    	  add  a,40
C646: 6F      	  ld   l,a
C647: 3001    	  jr   nc,_IDNoCarry
C649: 24      	  inc  h
C64A:         	_IDNoCarry:
C64A: F1      	  pop  af        ; restore line counter
C64B: D610    	  sub  a,$10       ; decrement the upper nibble of the counter
C64D: FE10    	  cp   a,$10       ; until upper nibble is $00
C64F: 30D5    	  jr   nc,_IDOuter
              	
C651: C9      	  ret
C652:         	IDCalculatePos:
C652: D5      	  push  de
C653: 7C      	  ld   a,h       ; save X in A
C654: 2600    	  ld   h,0       ; HL = Y
              	
C656: 29      	  add  hl,hl       ; HL = Y x 8
C657: 29      	  add  hl,hl
C658: 29      	  add  hl,hl
C659: 5D      	  ld   e,l       ; DE = Y x 8
C65A: 54      	  ld  d,h
C65B: 29      	  add  hl,hl       ; HL = Y x 32
C65C: 29      	  add  hl,hl
C65D: 19      	  add  hl,de       ; HL = Y x 40
              	
C65E: 5F      	  ld   e,a       ; DE = X
C65F: 1600    	  ld   d,0
C661: 19      	  add  hl,de       ; HL = X + Y x 40
              	
C662: 112830  	  ld   de,$3028      ; now a screen position
C665: 19      	  add  hl,de
              	
C666: D1      	  pop  de
C667: C9      	  ret
C668:         	CopySpriteData:
C668: C5      	  push  bc
C669: D5      	  push  de
C66A: E5      	  push  hl
C66B: 7E      	  ld   a,(hl)       ; point to sprite in HL and DE
C66C: 23      	  inc  hl
C66D: 66      	  ld   h,(hl)
C66E: 6F      	  ld   l,a
C66F: 5D      	  ld   e,l
C670: 54      	  ld   d,h
C671: 010600  	  ld   bc,6       ; HL points to the values, DE to the update values.
C674: 09      	  add  hl,bc
C675: EB      	  ex   de,hl       ; HL is the update values, DE the target values.
C676: 0603    	  ld   b,3       ; update potentially three values
C678:         	_CSDLoop:
C678: 7E      	  ld   a,(hl)       ; check HL points to $FFFF
C679: 23      	  inc  hl
C67A: A6      	  and  (hl)
C67B: 3C      	  inc  a        ; zero if was $FF
C67C: 280C    	  jr   z,_CSDNext
              	
C67E: 2B      	  dec  hl        ; HL/DE are first byte
C67F: 7E      	  ld   a,(hl)
C680: 12      	  ld   (de),a
C681: 36FF    	  ld   (hl),$FF
C683: 13      	  inc  de        ; second byte
C684: 23      	  inc  hl
C685: 7E      	  ld   a,(hl)
C686: 12      	  ld   (de),a
C687: 36FF    	  ld   (hl),$FF
C689: 1B      	  dec  de        ; fix so both increments +2
C68A:         	_CSDNext:
C68A: 13      	  inc  de
C68B: 13      	  inc  de
C68C: 23      	  inc  hl
C68D: 10E9    	  djnz  _CSDLoop
              	
C68F: E1      	  pop  hl
C690: D1      	  pop  de
C691: C1      	  pop  bc
C692: C9      	  ret
              	
              	
C693:         	DrawOneSprite:
C693: C5      	  push  bc
C694: D5      	  push  de
C695: E5      	  push  hl
              	
C696: 7E      	  ld   a,(hl)       ; point to sprite in HL and BC
C697: 23      	  inc  hl
C698: 66      	  ld   h,(hl)
C699: 6F      	  ld   l,a
              	
C69A: 010C00  	  ld   bc,12       ; point to storage space HL
C69D: 09      	  add  hl,bc
              	
C69E: 44      	  ld   b,h       ; storage space in BC.
C69F: 4D      	  ld   c,l
              	
C6A0: 2B      	  dec  hl        ; graphic address in DE.
C6A1: 56      	  ld   d,(hl)
C6A2: 2B      	  dec  hl
C6A3: 5E      	  ld   e,(hl)
              	
C6A4: 7A      	  ld   a,d       ; if $FFFF do
C6A5: A3      	  and  e
C6A6: 3C      	  inc  a
C6A7: 280A    	  jr   z,_DOSExit
              	
C6A9: 2B      	  dec  hl        ; Y in A
C6AA: 2B      	  dec  hl
C6AB: 7E      	  ld   a,(hl)
C6AC: 2B      	  dec  hl        ; X in L
C6AD: 2B      	  dec  hl
C6AE: 66      	  ld   h,(hl)
C6AF: 6F      	  ld   l,a       ; HL = (X,Y)
              	
C6B0: CD17C6  	  call  ImageDraw      ; draw the image copying the background
              	
C6B3:         	_DOSExit:
C6B3: E1      	  pop  hl
C6B4: D1      	  pop  de
C6B5: C1      	  pop  bc
C6B6: C9      	  ret
              	
              	
C6B7:         	EraseOneSprite:
C6B7: C5      	  push  bc
C6B8: D5      	  push  de
C6B9: E5      	  push  hl
              	
              	
C6BA: 7E      	  ld   a,(hl)       ; point to sprite in HL and DE
C6BB: 23      	  inc  hl
C6BC: 66      	  ld   h,(hl)
C6BD: 6F      	  ld   l,a
              	
C6BE: 010C00  	  ld   bc,12       ; point to storage space.
C6C1: 09      	  add  hl,bc
              	
C6C2: 54      	  ld   d,h       ; storage space in DE, drawing fom here
C6C3: 5D      	  ld   e,l
              	
C6C4: 010000  	  ld   bc,$0000      ; copy data to ROM.
              	
C6C7: 2B      	  dec  hl        ; if graphic is $FFFF do nothing.
C6C8: 7E      	  ld   a,(hl)
C6C9: 2B      	  dec  hl
C6CA: A6      	  and  (hl)
C6CB: 3C      	  inc  a
C6CC: 280A    	  jr   z,_EOSExit
              	
C6CE: 2B      	  dec  hl        ; Y in A
C6CF: 2B      	  dec  hl
C6D0: 7E      	  ld   a,(hl)
C6D1: 2B      	  dec  hl        ; X in L
C6D2: 2B      	  dec  hl
C6D3: 66      	  ld   h,(hl)
C6D4: 6F      	  ld   l,a       ; HL = (X,Y)
              	
C6D5: CD17C6  	  call  ImageDraw      ; draw the image copying the background
              	
C6D8:         	_EOSExit:
C6D8: E1      	  pop  hl
C6D9: D1      	  pop  de
C6DA: C1      	  pop  bc
C6DB: C9      	  ret
C6DC:         	FreeSpace:
              	
              	; ***************************************************************************************
              	;
              	;										ROM Header
              	;
              	; ***************************************************************************************
              	
C6DC: FFFFFFFF		.org	$E000
C6E0: FF...   	
E000: 50535200		.db  	"PSR",0 						; 4 bytes filler.
E004: 009C00B0		.db  	0,$9C,0,$B0,0,$6C 				; 12 bytes ROM Identify
E008: 006C    	
E00A: 006400A8		.db 	0,$64,0,$A8,$5F,$70 			; the $5F makes the total $70 so $00 is output to scrambler
E00E: 5F70    	
              		.org 	$E010
E010: C300C0  		jp 		start 							; BIOS enters here.
              	
              	
E013: FFFFFFFF		.org 	$E100
E017: FF...   	
E100:         	testCode:
E100: D3CCCFD7		.incbin "m7source.bin"
E104: 60706064	
E108: 71707070	
E10C: 60436160	
E110: 7BE0C6C1	
E114: D3D46071	
E118: 60647170	
E11C: 70706043	
E120: 61607BA0	
E124: 86819394	
E128: E0CDC1CB	
E12C: C5EEC9CD	
E130: CDC5C4C9	
E134: C1D4C560	
E138: 6D736048	
E13C: 606B6160	
E140: 7BE0C9CD	
E144: CDC5C4C9	
E148: C1D4C5A0	
E14C: 8D818B85	
E150: AE898D8D	
E154: 85848981	
E158: 9485604D	
E15C: 414B456E	
E160: 494D4D45	
E164: 44494154	
E168: 45607BE0	
E16C: C3CFCDD0	
E170: C9CCC5EE	
E174: CFCECCD9	
E178: A08D818B	
E17C: 85AE898D	
E180: 8D858489	
E184: 81948560	
E188: 64444943	
E18C: 54494F4E	
E190: 41525960	
E194: 43406064	
E198: 7071604F	
E19C: 52606444	
E1A0: 49435449	
E1A4: 4F4E4152	
E1A8: 59604361	
E1AC: 607BE0DF	
E1B0: D4C9CDC5	
E1B4: D3DFCCCF	
E1B8: CFD06056	
E1BC: 41524941	
E1C0: 424C45E0	
E1C4: DFD2C5D0	
E1C8: C5C1D4DF	
E1CC: CCCFCFD0	
E1D0: 60564152	
E1D4: 4941424C	
E1D8: 45E0DFC9	
E1DC: C6DFD0C1	
E1E0: D4C3C860	
E1E4: 56415249	
E1E8: 41424C45	
E1EC: E0D4C9CD	
E1F0: C5D36049	
E1F4: 4D4D4544	
E1F8: 49415445	
E1FC: 60434F4D	
E200: 50494C45	
E204: 6E4F4E4C	
E208: 59604860	
E20C: 4040605F	
E210: 54494D45	
E214: 535F4C4F	
E218: 4F506061	
E21C: 61606472	
E220: 4260436C	
E224: 60644575	
E228: 60436C60	
E22C: 7BE0D4C5	
E230: CEC46049	
E234: 4D4D4544	
E238: 49415445	
E23C: 60434F4D	
E240: 50494C45	
E244: 6E4F4E4C	
E248: 59606445	
E24C: 7160436C	
E250: 60647743	
E254: 60436C60	
E258: 64427560	
E25C: 436C6064	
E260: 43726043	
E264: 6C605F54	
E268: 494D4553	
E26C: 5F4C4F4F	
E270: 50604040	
E274: 606C607B	
E278: E0D2C5D0	
E27C: C5C1D460	
E280: 494D4D45	
E284: 44494154	
E288: 4560434F	
E28C: 4D50494C	
E290: 456E4F4E	
E294: 4C596048	
E298: 60404060	
E29C: 5F524550	
E2A0: 4541545F	
E2A4: 4C4F4F50	
E2A8: 60616160	
E2AC: 7BE0D5CE	
E2B0: D4C9CC60	
E2B4: 494D4D45	
E2B8: 44494154	
E2BC: 4560434F	
E2C0: 4D50494C	
E2C4: 456E4F4E	
E2C8: 4C596064	
E2CC: 77436043	
E2D0: 6C606442	
E2D4: 7560436C	
E2D8: 60644341	
E2DC: 60436C60	
E2E0: 5F524550	
E2E4: 4541545F	
E2E8: 4C4F4F50	
E2EC: 60404060	
E2F0: 6C607BE0	
E2F4: C6CFD2C5	
E2F8: D6C5D260	
E2FC: 494D4D45	
E300: 44494154	
E304: 4560434F	
E308: 4D50494C	
E30C: 456E4F4E	
E310: 4C596064	
E314: 43736043	
E318: 6C605F52	
E31C: 45504541	
E320: 545F4C4F	
E324: 4F506040	
E328: 40606C60	
E32C: 7BE0C9C6	
E330: 60494D4D	
E334: 45444941	
E338: 54456043	
E33C: 4F4D5049	
E340: 4C456E4F	
E344: 4E4C5960	
E348: 64774360	
E34C: 436C6064	
E350: 42756043	
E354: 6C606443	
E358: 4160436C	
E35C: 60486040	
E360: 40605F49	
E364: 465F5041	
E368: 54434860	
E36C: 61616070	
E370: 606C607B	
E374: E0EDC9C6	
E378: 60494D4D	
E37C: 45444941	
E380: 54456043	
E384: 4F4D5049	
E388: 4C456E4F	
E38C: 4E4C5960	
E390: 64434260	
E394: 436C6064	
E398: 77436043	
E39C: 6C606443	
E3A0: 4160436C	
E3A4: 60486040	
E3A8: 40605F49	
E3AC: 465F5041	
E3B0: 54434860	
E3B4: 61616070	
E3B8: 606C607B	
E3BC: E0C5CCD3	
E3C0: C560494D	
E3C4: 4D454449	
E3C8: 41544560	
E3CC: 434F4D50	
E3D0: 494C456E	
E3D4: 4F4E4C59	
E3D8: 60486040	
E3DC: 40607360	
E3E0: 6B605F49	
E3E4: 465F5041	
E3E8: 54434860	
E3EC: 40406061	
E3F0: 60644373	
E3F4: 60436C60	
E3F8: 48604040	
E3FC: 605F4946	
E400: 5F504154	
E404: 43486061	
E408: 61607060	
E40C: 6C607BE0	
E410: D4C8C5CE	
E414: 60494D4D	
E418: 45444941	
E41C: 54456043	
E420: 4F4D5049	
E424: 4C456E4F	
E428: 4E4C5960	
E42C: 48604040	
E430: 605F4946	
E434: 5F504154	
E438: 43486040	
E43C: 40606160	
E440: 7BE0C9D3	
E444: EEC2C1D3	
E448: C5605641	
E44C: 52494142	
E450: 4C45E0C9	
E454: D3EEC8C5	
E458: D8604142	
E45C: 7E526071	
E460: 76604953	
E464: 6E424153	
E468: 45606161	
E46C: 60527E41	
E470: 42607BE0	
E474: C9D3EEC4	
E478: C5C36041	
E47C: 427E5260	
E480: 71706049	
E484: 536E4241	
E488: 53456061	
E48C: 6160527E	
E490: 4142607B	
E494: A08993AE	
E498: 848583E0	
E49C: C9D3EEC2	
E4A0: D5C6C6C5	
E4A4: D2A0B1B0	
E4A8: 60415252	
E4AC: 4159E0C9	
E4B0: D3EEC2D5	
E4B4: C6D0D4D2	
E4B8: 60564152	
E4BC: 4941424C	
E4C0: 45E0C9D3	
E4C4: EEDFD7C2	
E4C8: D5C6C6C5	
E4CC: D2604953	
E4D0: 6E425546	
E4D4: 50545260	
E4D8: 40406061	
E4DC: 60716049	
E4E0: 536E4255	
E4E4: 46505452	
E4E8: 606B6160	
E4EC: 7BE0DFC9	
E4F0: D3EEC3CF	
E4F4: CED6C5D2	
E4F8: D460417E	
E4FC: 43604953	
E500: 6E424153	
E504: 45604040	
E508: 604D4F44	
E50C: 60417E52	
E510: 60437E41	
E514: 6049536E	
E518: 42415345	
E51C: 60404060	
E520: 6F604946	
E524: 605F4953	
E528: 6E434F4E	
E52C: 56455254	
E530: 60544845	
E534: 4E60527E	
E538: 41607170	
E53C: 606D606D	
E540: 49466075	
E544: 7860454C	
E548: 53456076	
E54C: 75605448	
E550: 454E606B	
E554: 6049536E	
E558: 5F574255	
E55C: 46464552	
E560: 607BE0C9	
E564: D3EED5C3	
E568: CFCED6C5	
E56C: D2D46041	
E570: 7E526049	
E574: 536E4255	
E578: 46464552	
E57C: 6049536E	
E580: 42554650	
E584: 54526061	
E588: 6160527E	
E58C: 41605F49	
E590: 536E434F	
E594: 4E564552	
E598: 54604953	
E59C: 6E425546	
E5A0: 46455260	
E5A4: 7BE0C9D3	
E5A8: EED3C3CF	
E5AC: CED6C5D2	
E5B0: D460417E	
E5B4: 52604953	
E5B8: 6E425546	
E5BC: 46455260	
E5C0: 49536E42	
E5C4: 55465054	
E5C8: 52606161	
E5CC: 60527E41	
E5D0: 606D4946	
E5D4: 60706D60	
E5D8: 417E5260	
E5DC: 74756049	
E5E0: 536E5F57	
E5E4: 42554646	
E5E8: 45526052	
E5EC: 7E416054	
E5F0: 48454E60	
E5F4: 5F49536E	
E5F8: 434F4E56	
E5FC: 45525460	
E600: 49536E42	
E604: 55464645	
E608: 52607BE0	
E60C: C3CFCEEE	
E610: D0CFD360	
E614: 56415249	
E618: 41424C45	
E61C: E0C3CFCE	
E620: EED86056	
E624: 41524941	
E628: 424C45E0	
E62C: C3CFCEEE	
E630: D9605641	
E634: 52494142	
E638: 4C45E0C3	
E63C: CFCEEEC3	
E640: CFCCCFD5	
E644: D2605641	
E648: 52494142	
E64C: 4C45E0C3	
E650: CFCEEED3	
E654: C3D2CFCC	
E658: CCA0B2B2	
E65C: 60434F4E	
E660: 5354414E	
E664: 54E0C3CF	
E668: CEEEC2C1	
E66C: D3C5A0A4	
E670: B3B0B2B8	
E674: 60434F4E	
E678: 5354414E	
E67C: 54E0C3CF	
E680: CEEED7C9	
E684: C4D4C8A0	
E688: B4B06043	
E68C: 4F4E5354	
E690: 414E54E0	
E694: C3CFCEEE	
E698: C8C5C9C7	
E69C: C8D4A0B2	
E6A0: B460434F	
E6A4: 4E535441	
E6A8: 4E54A0A4	
E6AC: B2B0A083	
E6B0: 8F8EAE83	
E6B4: 8F8C8F95	
E6B8: 92A0A1E0	
E6BC: C3CFCEEE	
E6C0: C8CFCDC5	
E6C4: 6041427E	
E6C8: 52607060	
E6CC: 434F4E6E	
E6D0: 58606161	
E6D4: 60706043	
E6D8: 4F4E6E59	
E6DC: 60616160	
E6E0: 434F4E6E	
E6E4: 42415345	
E6E8: 60434F4E	
E6EC: 6E504F53	
E6F0: 60616160	
E6F4: 527E4142	
E6F8: 607BE0C3	
E6FC: CFCEEEC9	
E700: CECB6041	
E704: 427E5260	
E708: 71756041	
E70C: 4E446041	
E710: 7E526043	
E714: 4F4E6E43	
E718: 4F4C4F55	
E71C: 52604040	
E720: 60647046	
E724: 60414E44	
E728: 60434F4E	
E72C: 6E434F4C	
E730: 4F555260	
E734: 61616052	
E738: 7E416071	
E73C: 766A6043	
E740: 4F4E6E43	
E744: 4F4C4F55	
E748: 52606B61	
E74C: 60527E41	
E750: 42607BE0	
E754: C3CFCEEE	
E758: D0C1D0C5	
E75C: D2604142	
E760: 7E526071	
E764: 7560414E	
E768: 4460417E	
E76C: 5260434F	
E770: 4E6E434F	
E774: 4C4F5552	
E778: 60404060	
E77C: 64467060	
E780: 414E4460	
E784: 434F4E6E	
E788: 434F4C4F	
E78C: 55526061	
E790: 6160527E	
E794: 4160434F	
E798: 4E6E434F	
E79C: 4C4F5552	
E7A0: 606B6160	
E7A4: 527E4142	
E7A8: 607BE0C3	
E7AC: CFCEEEC3	
E7B0: CCC5C1D2	
E7B4: 60414243	
E7B8: 7E526043	
E7BC: 4F4E6E48	
E7C0: 4F4D4560	
E7C4: 71707274	
E7C8: 60417E43	
E7CC: 60647370	
E7D0: 70706064	
E7D4: 72706046	
E7D8: 494C4C60	
E7DC: 64737470	
E7E0: 7060434F	
E7E4: 4E6E434F	
E7E8: 4C4F5552	
E7EC: 60404060	
E7F0: 46494C4C	
E7F4: 60527E41	
E7F8: 4243607B	
E7FC: E0C3CFCE	
E800: EEC3CCC5	
E804: C1D2EEC5	
E808: C4C9D460	
E80C: 4142437E	
E810: 5260434F	
E814: 4E6E4845	
E818: 49474854	
E81C: 60434F4E	
E820: 6E534352	
E824: 4F4C4C60	
E828: 6D60434F	
E82C: 4E6E5749	
E830: 44544860	
E834: 6A60417E	
E838: 4360434F	
E83C: 4E6E5343	
E840: 524F4C4C	
E844: 60434F4E	
E848: 6E574944	
E84C: 5448606A	
E850: 60434F4E	
E854: 6E424153	
E858: 45606B60	
E85C: 417E5260	
E860: 64727060	
E864: 46494C4C	
E868: 60527E41	
E86C: 60647470	
E870: 70606B60	
E874: 434F4E6E	
E878: 434F4C4F	
E87C: 55526040	
E880: 40604649	
E884: 4C4C6052	
E888: 7E414243	
E88C: 607BE0DF	
E890: C3CFCEEE	
E894: D3C3D2CF	
E898: CCCC6043	
E89C: 4F4E6E53	
E8A0: 43524F4C	
E8A4: 4C606D6D	
E8A8: 60434F4E	
E8AC: 6E574944	
E8B0: 5448606A	
E8B4: 60417E43	
E8B8: 60434F4E	
E8BC: 6E424153	
E8C0: 45606473	
E8C4: 70757060	
E8C8: 434F5059	
E8CC: 60647374	
E8D0: 72786064	
E8D4: 73747570	
E8D8: 60434F50	
E8DC: 59607470	
E8E0: 60417E43	
E8E4: 60434F4E	
E8E8: 6E534352	
E8EC: 4F4C4C60	
E8F0: 6D6D6043	
E8F4: 4F4E6E57	
E8F8: 49445448	
E8FC: 606A6043	
E900: 4F4E6E42	
E904: 41534560	
E908: 6B60417E	
E90C: 52606472	
E910: 70604649	
E914: 4C4C6052	
E918: 7E416071	
E91C: 70727460	
E920: 6B60434F	
E924: 4E6E434F	
E928: 4C4F5552	
E92C: 60404060	
E930: 46494C4C	
E934: 606D7160	
E938: 434F4E6E	
E93C: 59606B61	
E940: 60434F4E	
E944: 6E574944	
E948: 54486070	
E94C: 6D60434F	
E950: 4E6E504F	
E954: 53606B61	
E958: 607BE0DF	
E95C: C3CFCEEE	
E960: C4CFD7CE	
E964: 60716043	
E968: 4F4E6E59	
E96C: 606B6160	
E970: 7060434F	
E974: 4E6E5860	
E978: 61616043	
E97C: 4F4E6E59	
E980: 60404060	
E984: 434F4E6E	
E988: 5343524F	
E98C: 4C4C607D	
E990: 60494660	
E994: 5F434F4E	
E998: 6E534352	
E99C: 4F4C4C60	
E9A0: 5448454E	
E9A4: 607B607B	
E9A8: E0DFC3CF	
E9AC: CEEEC5CD	
E9B0: C9D46043	
E9B4: 4F4E6E50	
E9B8: 4F536040	
E9BC: 60436160	
E9C0: 434F4E6E	
E9C4: 504F5360	
E9C8: 40406071	
E9CC: 70727460	
E9D0: 6B60434F	
E9D4: 4E6E434F	
E9D8: 4C4F5552	
E9DC: 60404060	
E9E0: 53574150	
E9E4: 60436160	
E9E8: 7160434F	
E9EC: 4E6E504F	
E9F0: 53606B61	
E9F4: 60716043	
E9F8: 4F4E6E58	
E9FC: 606B6160	
EA00: 434F4E6E	
EA04: 58604040	
EA08: 60434F4E	
EA0C: 6E574944	
EA10: 5448607D	
EA14: 60494660	
EA18: 5F434F4E	
EA1C: 6E444F57	
EA20: 4E605448	
EA24: 454E607B	
EA28: E0C3CFCE	
EA2C: EEC3D260	
EA30: 4142437E	
EA34: 52605245	
EA38: 50454154	
EA3C: 60737260	
EA40: 5F434F4E	
EA44: 6E454D49	
EA48: 5460434F	
EA4C: 4E6E5860	
EA50: 40406070	
EA54: 7D60554E	
EA58: 54494C60	
EA5C: 527E4142	
EA60: 43607BE0	
EA64: C3CFCEEE	
EA68: C5CDC9D4	
EA6C: 60414243	
EA70: 7E526041	
EA74: 7E526071	
EA78: 73607D60	
EA7C: 49466052	
EA80: 7E416043	
EA84: 4F4E6E43	
EA88: 5260454C	
EA8C: 53456052	
EA90: 7E41605F	
EA94: 434F4E6E	
EA98: 454D4954	
EA9C: 60544845	
EAA0: 4E60527E	
EAA4: 41424360	
EAA8: 7BE0C3CF	
EAAC: CEEED0D2	
EAB0: C9CED460	
EAB4: 41427E52	
EAB8: 60524550	
EABC: 45415460	
EAC0: 417E4260	
EAC4: 43406049	
EAC8: 4660434F	
EACC: 4E6E454D	
EAD0: 49546045	
EAD4: 4C534560	
EAD8: 527E4142	
EADC: 607B6054	
EAE0: 48454E60	
EAE4: 427E4160	
EAE8: 6B6B6046	
EAEC: 4F524556	
EAF0: 4552607B	
EAF4: E0C3CFCE	
EAF8: EECDCFD6	
EAFC: C5604142	
EB00: 7E526042	
EB04: 7E526043	
EB08: 4F4E6E59	
EB0C: 60616160	
EB10: 527E4160	
EB14: 434F4E6E	
EB18: 58606161	
EB1C: 60434F4E	
EB20: 6E596040	
EB24: 40607470	
EB28: 606A6043	
EB2C: 4F4E6E58	
EB30: 60404060	
EB34: 6B60434F	
EB38: 4E6E4241	
EB3C: 5345606B	
EB40: 60434F4E	
EB44: 6E504F53	
EB48: 60616160	
EB4C: 527E4142	
EB50: 607BE0C3	
EB54: CFCEEEC9	
EB58: CECBC5D9	
EB5C: 60427E52	
EB60: 60437E52	
EB64: A0A48384	
EB68: A083ACA0	
EB6C: A4B18581	
EB70: B2A0ACA0	
EB74: A4B686A0	
EB78: 83ACA0A4	
EB7C: B2B6A083	
EB80: ACA0A4B0	
EB84: B0A083AC	
EB88: 60527E43	
EB8C: 60527E42	
EB90: 607BE0C3	
EB94: CFCEEEC7	
EB98: C5D46052	
EB9C: 45504541	
EBA0: 5460434F	
EBA4: 4E6E494E	
EBA8: 4B455960	
EBAC: 554E5449	
EBB0: 4C607BE0	
EBB4: C3CFCEEE	
EBB8: D0D5D3C8	
EBBC: EED3D4C1	
EBC0: D4C56052	
EBC4: 7E436043	
EBC8: 4F4E6E58	
EBCC: 60404060	
EBD0: 417E5260	
EBD4: 434F4E6E	
EBD8: 59604040	
EBDC: 60417E52	
EBE0: 60434F4E	
EBE4: 6E504F53	
EBE8: 60404060	
EBEC: 417E5260	
EBF0: 434F4E6E	
EBF4: 434F4C4F	
EBF8: 55526040	
EBFC: 4060417E	
EC00: 5260437E	
EC04: 52607BE0	
EC08: C3CFCEEE	
EC0C: D0CFD0EE	
EC10: D3D4C1D4	
EC14: C560527E	
EC18: 4360527E	
EC1C: 4160434F	
EC20: 4E6E434F	
EC24: 4C4F5552	
EC28: 60616160	
EC2C: 527E4160	
EC30: 434F4E6E	
EC34: 504F5360	
EC38: 61616052	
EC3C: 7E416043	
EC40: 4F4E6E59	
EC44: 60616160	
EC48: 527E4160	
EC4C: 434F4E6E	
EC50: 58606161	
EC54: 60437E52	
EC58: 607BE0C3	
EC5C: CFCEEED3	
EC60: D0D2C9CE	
EC64: D4604953	
EC68: 6E53434F	
EC6C: 4E564552	
EC70: 5460434F	
EC74: 4E6E5052	
EC78: 494E5460	
EC7C: 7BE0C3CF	
EC80: CEEED5D0	
EC84: D2C9CED4	
EC88: 6049536E	
EC8C: 55434F4E	
EC90: 56455254	
EC94: 60434F4E	
EC98: 6E505249	
EC9C: 4E54607B	
ECA0: E0C9C6EE	
ECA4: C2D5C6C6	
ECA8: C5D2A0B3	
ECAC: B2604152	
ECB0: 524159E0	
ECB4: C9C6EEC2	
ECB8: D0D4D260	
ECBC: 56415249	
ECC0: 41424C45	
ECC4: E0C9C6EE	
ECC8: CDC1C9CE	
ECCC: 6049466E	
ECD0: 42505452	
ECD4: 60616160	
ECD8: 434F4E6E	
ECDC: 50555348	
ECE0: 6E535441	
ECE4: 54456043	
ECE8: 4F4E6E43	
ECEC: 4C454152	
ECF0: 6E454449	
ECF4: 54607560	
ECF8: 434F4E6E	
ECFC: 494E4B60	
ED00: 7060434F	
ED04: 4E6E5041	
ED08: 50455260	
ED0C: 434F4E6E	
ED10: 57494454	
ED14: 4860726F	
ED18: 60434F4E	
ED1C: 6E484549	
ED20: 47485460	
ED24: 6D6D6D60	
ED28: 434F4E6E	
ED2C: 4D4F5645	
ED30: 6049466E	
ED34: 42505452	
ED38: 60404060	
ED3C: 434F4E6E	
ED40: 5052494E	
ED44: 54604946	
ED48: 6E425546	
ED4C: 46455260	
ED50: 49466E42	
ED54: 50545260	
ED58: 61616073	
ED5C: 6054494D	
ED60: 45536041	
ED64: 7E436079	
ED68: 606A6071	
ED6C: 73606B60	
ED70: 434F4E6E	
ED74: 48454947	
ED78: 4854606D	
ED7C: 6D60434F	
ED80: 4E6E4D4F	
ED84: 56456077	
ED88: 60434F4E	
ED8C: 6E494E4B	
ED90: 60437E41	
ED94: 60767560	
ED98: 6B60434F	
ED9C: 4E6E454D	
EDA0: 49546073	
EDA4: 7260434F	
EDA8: 4E6E454D	
EDAC: 49546076	
EDB0: 60434F4E	
EDB4: 6E494E4B	
EDB8: 60645359	
EDBC: 5354454D	
EDC0: 6074606B	
EDC4: 60406041	
EDC8: 7E426043	
EDCC: 7E416072	
EDD0: 6A606B60	
EDD4: 40604953	
EDD8: 6E53434F	
EDDC: 4E564552	
EDE0: 5460434F	
EDE4: 4E6E5052	
EDE8: 494E5460	
EDEC: 54454E44	
EDF0: 60706043	
EDF4: 4F4E6E48	
EDF8: 45494748	
EDFC: 54606D6D	
EE00: 6D60434F	
EE04: 4E6E4D4F	
EE08: 56456073	
EE0C: 60434F4E	
EE10: 6E494E4B	
EE14: 60524550	
EE18: 45415460	
EE1C: 434F4E6E	
EE20: 47455460	
EE24: 7373606D	
EE28: 606D4946	
EE2C: 60434F4E	
EE30: 6E504F50	
EE34: 6E535441	
EE38: 54456049	
EE3C: 466E4255	
EE40: 46464552	
EE44: 6064434F	
EE48: 4D50494C	
EE4C: 45526054	
EE50: 48454E60	
EE54: 7373606B	
EE58: 60434F4E	
EE5C: 6E454D49	
EE60: 54607976	
EE64: 606D606D	
EE68: 49466079	
EE6C: 76606B60	
EE70: 454C5345	
EE74: 60767460	
EE78: 6B605448	
EE7C: 454E6064	
EE80: 73466041	
EE84: 4E446064	
EE88: 7870604F	
EE8C: 52604946	
EE90: 6E425054	
EE94: 52604040	
EE98: 60616071	
EE9C: 6049466E	
EEA0: 42505452	
EEA4: 606B6160	
EEA8: 464F5245	
EEAC: 56455260	
EEB0: 7BE0C9C6	
EEB4: EEC9CED3	
EEB8: D4C1CCCC	
EEBC: 60645359	
EEC0: 5354454D	
EEC4: 606B6B6B	
EEC8: 6049466E	
EECC: 4D41494E	
EED0: 60414444	
EED4: 52455353	
EED8: 6E4F4660	
EEDC: 53574150	
EEE0: 6061607B	
EEE4: A08986AE	
EEE8: 898E9394	
EEEC: 818C8CE0	
EEF0: D3C7EEC9	
EEF4: CEC9D460	
EEF8: 41427E52	
EEFC: 60706053	
EF00: 57415060	
EF04: 6160527E	
EF08: 4142607B	
EF0C: E0D3C7EE	
EF10: C1C4C460	
EF14: 4142437E	
EF18: 5260427E	
EF1C: 5260427E	
EF20: 52607160	
EF24: 53574150	
EF28: 606B6160	
EF2C: 417E4260	
EF30: 4060726A	
EF34: 606B6052	
EF38: 7E426061	
EF3C: 60717260	
EF40: 417E4360	
EF44: 527E4160	
EF48: 64464660	
EF4C: 46494C4C	
EF50: 60527E41	
EF54: 4243607B	
EF58: E0D3D0EE	
EF5C: D8E16061	
EF60: 607BE0D3	
EF64: D0EED9E1	
EF68: 60417E52	
EF6C: 606B6B6B	
EF70: 60616052	
EF74: 7E41607B	
EF78: E0D3D0EE	
EF7C: C9CDC1C7	
EF80: C5E16041	
EF84: 7E52606B	
EF88: 6B6B606B	
EF8C: 6B6B6061	
EF90: 60527E41	
EF94: 607BE0C7	
EF98: D2C1D0C8	
EF9C: C9C36044	
EFA0: 415441A0	
EFA4: A4B2B2A0	
EFA8: 83ACA0B1	
EFAC: B9B2A083	
EFB0: ACA0A4B3	
EFB4: B0A083AC	
EFB8: A0B1B9B3	
EFBC: A083ACA0	
EFC0: A4B3B0A0	
EFC4: 83ACA0B2	
EFC8: B0A083AC	
EFCC: A0A4B5B0	
EFD0: A083ACA0	
EFD4: B2B0A083	
EFD8: ACA0A4B5	
EFDC: B0A083AC	
EFE0: E0C7D2C1	
EFE4: D0C8C9C3	
EFE8: F2604441	
EFEC: 5441A0A4	
EFF0: B2B2A083	
EFF4: ACA0B1B9	
EFF8: B2A083AC	
EFFC: A0A4B3B0	
F000: A083ACA0	
F004: B1B9B3A0	
F008: 83ACA0A4	
F00C: B3B0A083	
F010: ACA0B2B0	
F014: A083ACA0	
F018: A4B6B0A0	
F01C: 83ACA0B2	
F020: B0A083AC	
F024: A0A4B6B0	
F028: A083ACA0	
F02C: 838F8EAE	
F030: 838C8581	
F034: 92A0938C	
F038: 8F97E0C7	
F03C: D2CFD5D0	
F040: A0B3B260	
F044: 41525241	
F048: 59E0D3D0	
F04C: D2F1A0B2	
F050: B2604152	
F054: 524159E0	
F058: D3D0D2F2	
F05C: A0B2B260	
F060: 41525241	
F064: 59E0D2C6	
F068: C9CCCC60	
F06C: 79767060	
F070: 54494D45	
F074: 53606473	
F078: 70727860	
F07C: 6B60417E	
F080: 42604361	
F084: 6054454E	
F088: 44607BE0	
F08C: D0C1D5D3	
F090: C5607170	
F094: 70706054	
F098: 494D4553	
F09C: 6054454E	
F0A0: 44607BE0	
F0A4: D4C5D3D4	
F0A8: 6049536E	
F0AC: 48455860	
F0B0: 47524F55	
F0B4: 5060434F	
F0B8: 4E6E5550	
F0BC: 52494E54	
F0C0: 60737260	
F0C4: 434F4E6E	
F0C8: 454D4954	
F0CC: 60535052	
F0D0: 7160434F	
F0D4: 4E6E5550	
F0D8: 52494E54	
F0DC: 6047524F	
F0E0: 55506053	
F0E4: 476E494E	
F0E8: 49546053	
F0EC: 50527160	
F0F0: 47524F55	
F0F4: 50605347	
F0F8: 6E414444	
F0FC: 60535052	
F100: 72604752	
F104: 4F555060	
F108: 53476E41	
F10C: 44446047	
F110: 52415048	
F114: 49436053	
F118: 50527160	
F11C: 53506E49	
F120: 4D414745	
F124: 61604752	
F128: 41504849	
F12C: 43726053	
F130: 50527260	
F134: 53506E49	
F138: 4D414745	
F13C: 61607460	
F140: 53505271	
F144: 6053506E	
F148: 58616076	
F14C: 60535052	
F150: 71605350	
F154: 6E596160	
F158: 72746053	
F15C: 50527260	
F160: 53506E58	
F164: 61607760	
F168: 53505272	
F16C: 6053506E	
F170: 59616052	
F174: 46494C4C	
F178: 60717070	
F17C: 70706054	
F180: 494D4553	
F184: 60417E43	
F188: 60727160	
F18C: 4D4F4460	
F190: 53505271	
F194: 6053506E	
F198: 59616043	
F19C: 7E416073	
F1A0: 79604D4F	
F1A4: 44605350	
F1A8: 52726053	
F1AC: 506E5861	
F1B0: 60437E41	
F1B4: 6077604D	
F1B8: 4F446074	
F1BC: 606B6053	
F1C0: 50527160	
F1C4: 53506E58	
F1C8: 61604752	
F1CC: 4F555060	
F1D0: 53476E44	
F1D4: 52415760	
F1D8: 50415553	
F1DC: 45604752	
F1E0: 4F555060	
F1E4: 53476E45	
F1E8: 52415345	
F1EC: 6054454E	
F1F0: 44607BA0	
F1F4: 94859394	
F1F8: 00      	
              	
              	; ***************************************************************************************
              	;
              	; 				Load the Dictionary into High memory, it works down.
              	;
              	; ***************************************************************************************
              	
              		.include "vocabulary/dictionary.inc" 	; get length
01F5:         	DictionarySize = 501
F1F9: FFFFFFFF		.org 	CodeEnd-DictionarySize+1 		; set start pointer
F1FD: FF...   	
FE0B:         	DictionaryInstalledBase:
              		.include "vocabulary/dictionary.asm" 	; pregenerated dictionary.
              	; <
FE0B: 80      		.db	$80
FE0C: A4C2    		.dw	word_1000
FE0E: BC      		.db	$bc
              	; =
FE0F: 80      		.db	$80
FE10: BCC2    		.dw	word_1001
FE12: BD      		.db	$bd
              	; -
FE13: 80      		.db	$80
FE14: CBC2    		.dw	word_1002
FE16: AD      		.db	$ad
              	; +
FE17: 80      		.db	$80
FE18: D5C2    		.dw	word_1003
FE1A: AB      		.db	$ab
              	; AND
FE1B: 80      		.db	$80
FE1C: DAC2    		.dw	word_1004
FE1E: 010E84  		.db	$1,$e,$84
              	; OR
FE21: 80      		.db	$80
FE22: E4C2    		.dw	word_1005
FE24: 0F92    		.db	$f,$92
              	; XOR
FE26: 80      		.db	$80
FE27: EEC2    		.dw	word_1006
FE29: 180F92  		.db	$18,$f,$92
              	; /
FE2C: 80      		.db	$80
FE2D: F8C2    		.dw	word_1007
FE2F: AF      		.db	$af
              	; MOD
FE30: 80      		.db	$80
FE31: 02C3    		.dw	word_1008
FE33: 0D0F84  		.db	$d,$f,$84
              	; !
FE36: 80      		.db	$80
FE37: 0BC3    		.dw	word_1009
FE39: A1      		.db	$a1
              	; @
FE3A: 80      		.db	$80
FE3B: 13C3    		.dw	word_1010
FE3D: 80      		.db	$80
              	; +!
FE3E: 80      		.db	$80
FE3F: 1BC3    		.dw	word_1011
FE41: 2BA1    		.db	$2b,$a1
              	; C!
FE43: 80      		.db	$80
FE44: 27C3    		.dw	word_1012
FE46: 03A1    		.db	$3,$a1
              	; C@
FE48: 80      		.db	$80
FE49: 2CC3    		.dw	word_1013
FE4B: 0380    		.db	$3,$80
              	; P@
FE4D: 80      		.db	$80
FE4E: 33C3    		.dw	word_1014
FE50: 1080    		.db	$10,$80
              	; P!
FE52: 80      		.db	$80
FE53: 3BC3    		.dw	word_1015
FE55: 10A1    		.db	$10,$a1
              	; ,
FE57: 80      		.db	$80
FE58: 41C3    		.dw	word_1016
FE5A: AC      		.db	$ac
              	; ;
FE5B: 81      		.db	$81
FE5C: 47C3    		.dw	word_1017
FE5E: BB      		.db	$bb
              	; C,
FE5F: 80      		.db	$80
FE60: 4DC3    		.dw	word_1018
FE62: 03AC    		.db	$3,$ac
              	; COPY
FE64: 80      		.db	$80
FE65: 54C3    		.dw	word_1019
FE67: 030F1099		.db	$3,$f,$10,$99
              	; FILL
FE6B: 80      		.db	$80
FE6C: 74C3    		.dw	word_1020
FE6E: 06090C8C		.db	$6,$9,$c,$8c
              	; HALT
FE72: 80      		.db	$80
FE73: 87C3    		.dw	word_1021
FE75: 08010C94		.db	$8,$1,$c,$94
              	; BREAK
FE79: 80      		.db	$80
FE7A: 8EC3    		.dw	word_1022
FE7C: 02120501		.db	$2,$12,$5,$1,$8b
FE80: 8B      	
              	; *
FE81: 80      		.db	$80
FE82: 93C3    		.dw	word_1023
FE84: AA      		.db	$aa
              	; SWAP
FE85: 80      		.db	$80
FE86: 99C3    		.dw	word_1024
FE88: 13170190		.db	$13,$17,$1,$90
              	; A>B
FE8C: 80      		.db	$80
FE8D: 9EC3    		.dw	word_1025
FE8F: 013E82  		.db	$1,$3e,$82
              	; A>C
FE92: 80      		.db	$80
FE93: A4C3    		.dw	word_1026
FE95: 013E83  		.db	$1,$3e,$83
              	; B>A
FE98: 80      		.db	$80
FE99: AAC3    		.dw	word_1027
FE9B: 023E81  		.db	$2,$3e,$81
              	; B>C
FE9E: 80      		.db	$80
FE9F: B0C3    		.dw	word_1028
FEA1: 023E83  		.db	$2,$3e,$83
              	; C>A
FEA4: 80      		.db	$80
FEA5: B6C3    		.dw	word_1029
FEA7: 033E81  		.db	$3,$3e,$81
              	; C>B
FEAA: 80      		.db	$80
FEAB: BCC3    		.dw	word_1030
FEAD: 033E82  		.db	$3,$3e,$82
              	; PUSH
FEB0: 81      		.db	$81
FEB1: C2C3    		.dw	word_1031
FEB3: 10151388		.db	$10,$15,$13,$88
              	; POP
FEB7: 81      		.db	$81
FEB8: C7C3    		.dw	word_1032
FEBA: 100F90  		.db	$10,$f,$90
              	; A>R
FEBD: 81      		.db	$81
FEBE: CDC3    		.dw	word_1033
FEC0: 013E92  		.db	$1,$3e,$92
              	; R>A
FEC3: 81      		.db	$81
FEC4: D2C3    		.dw	word_1034
FEC6: 123E81  		.db	$12,$3e,$81
              	; B>R
FEC9: 81      		.db	$81
FECA: D7C3    		.dw	word_1035
FECC: 023E92  		.db	$2,$3e,$92
              	; R>B
FECF: 81      		.db	$81
FED0: DCC3    		.dw	word_1036
FED2: 123E82  		.db	$12,$3e,$82
              	; C>R
FED5: 81      		.db	$81
FED6: E1C3    		.dw	word_1037
FED8: 033E92  		.db	$3,$3e,$92
              	; R>C
FEDB: 81      		.db	$81
FEDC: E6C3    		.dw	word_1038
FEDE: 123E83  		.db	$12,$3e,$83
              	; AB>R
FEE1: 81      		.db	$81
FEE2: EBC3    		.dw	word_1039
FEE4: 01023E92		.db	$1,$2,$3e,$92
              	; R>AB
FEE8: 81      		.db	$81
FEE9: F1C3    		.dw	word_1040
FEEB: 123E0182		.db	$12,$3e,$1,$82
              	; ABC>R
FEEF: 81      		.db	$81
FEF0: F7C3    		.dw	word_1041
FEF2: 0102033E		.db	$1,$2,$3,$3e,$92
FEF6: 92      	
              	; R>ABC
FEF7: 81      		.db	$81
FEF8: FEC3    		.dw	word_1042
FEFA: 123E0102		.db	$12,$3e,$1,$2,$83
FEFE: 83      	
              	; H
FEFF: 80      		.db	$80
FF00: 05C4    		.dw	word_1043
FF02: 88      		.db	$88
              	; $SYSTEM
FF03: 80      		.db	$80
FF04: 0DC4    		.dw	word_1044
FF06: 24131913		.db	$24,$13,$19,$13,$14,$5,$8d
FF0A: 14058D  	
              	; $DICTIONARY
FF0D: 80      		.db	$80
FF0E: 15C4    		.dw	word_1045
FF10: 24040903		.db	$24,$4,$9,$3,$14,$9,$f,$e,$1,$12,$99
FF14: 14090F0E	
FF18: 011299  	
              	; WARM.START
FF1B: 80      		.db	$80
FF1C: 1DC4    		.dw	word_1046
FF1E: 1701120D		.db	$17,$1,$12,$d,$2e,$13,$14,$1,$12,$94
FF22: 2E131401	
FF26: 1294    	
              	; REPORT.ERROR
FF28: 80      		.db	$80
FF29: 23C4    		.dw	word_1047
FF2B: 1205100F		.db	$12,$5,$10,$f,$12,$14,$2e,$5,$12,$12,$f,$92
FF2F: 12142E05	
FF33: 12120F92	
              	; $COMPILER
FF37: 80      		.db	$80
FF38: 29C4    		.dw	word_1048
FF3A: 24030F0D		.db	$24,$3,$f,$d,$10,$9,$c,$5,$92
FF3E: 10090C05	
FF42: 92      	
              	; CONSTANT
FF43: 80      		.db	$80
FF44: 2FC4    		.dw	word_1049
FF46: 030F0E13		.db	$3,$f,$e,$13,$14,$1,$e,$94
FF4A: 14010E94	
              	; VARIABLE
FF4E: 80      		.db	$80
FF4F: 44C4    		.dw	word_1050
FF51: 16011209		.db	$16,$1,$12,$9,$1,$2,$c,$85
FF55: 01020C85	
              	; DATA
FF59: 80      		.db	$80
FF5A: 59C4    		.dw	word_1051
FF5C: 04011481		.db	$4,$1,$14,$81
              	; ARRAY
FF60: 80      		.db	$80
FF61: 68C4    		.dw	word_1052
FF63: 01121201		.db	$1,$12,$12,$1,$99
FF67: 99      	
              	; ADDRESS.OF
FF68: 80      		.db	$80
FF69: 84C4    		.dw	word_1053
FF6B: 01040412		.db	$1,$4,$4,$12,$5,$13,$13,$2e,$f,$86
FF6F: 0513132E	
FF73: 0F86    	
              	; !!
FF75: 81      		.db	$81
FF76: 98C4    		.dw	word_1054
FF78: 21A1    		.db	$21,$a1
              	; @@
FF7A: 81      		.db	$81
FF7B: A9C4    		.dw	word_1055
FF7D: 0080    		.db	$0,$80
              	; ---
FF7F: 80      		.db	$80
FF80: B2C4    		.dw	word_1056
FF82: 2D2DAD  		.db	$2d,$2d,$ad
              	; --
FF85: 80      		.db	$80
FF86: B8C4    		.dw	word_1057
FF88: 2DAD    		.db	$2d,$ad
              	; ++
FF8A: 80      		.db	$80
FF8B: BDC4    		.dw	word_1058
FF8D: 2BAB    		.db	$2b,$ab
              	; +++
FF8F: 80      		.db	$80
FF90: C2C4    		.dw	word_1059
FF92: 2B2BAB  		.db	$2b,$2b,$ab
              	; 0-
FF95: 80      		.db	$80
FF96: C8C4    		.dw	word_1060
FF98: 30AD    		.db	$30,$ad
              	; 0<
FF9A: 80      		.db	$80
FF9B: D3C4    		.dw	word_1061
FF9D: 30BC    		.db	$30,$bc
              	; 0=
FF9F: 80      		.db	$80
FFA0: DEC4    		.dw	word_1062
FFA2: 30BD    		.db	$30,$bd
              	; 2*
FFA4: 80      		.db	$80
FFA5: E9C4    		.dw	word_1063
FFA7: 32AA    		.db	$32,$aa
              	; 4*
FFA9: 80      		.db	$80
FFAA: EEC4    		.dw	word_1064
FFAC: 34AA    		.db	$34,$aa
              	; 8*
FFAE: 80      		.db	$80
FFAF: F4C4    		.dw	word_1065
FFB1: 38AA    		.db	$38,$aa
              	; 16*
FFB3: 80      		.db	$80
FFB4: FBC4    		.dw	word_1066
FFB6: 3136AA  		.db	$31,$36,$aa
              	; 2/
FFB9: 80      		.db	$80
FFBA: 03C5    		.dw	word_1067
FFBC: 32AF    		.db	$32,$af
              	; 4/
FFBE: 80      		.db	$80
FFBF: 0BC5    		.dw	word_1068
FFC1: 34AF    		.db	$34,$af
              	; ABS
FFC3: 80      		.db	$80
FFC4: 17C5    		.dw	word_1069
FFC6: 010293  		.db	$1,$2,$93
              	; BSWAP
FFC9: 80      		.db	$80
FFCA: 20C5    		.dw	word_1070
FFCC: 02131701		.db	$2,$13,$17,$1,$90
FFD0: 90      	
              	; NOT
FFD1: 80      		.db	$80
FFD2: 27C5    		.dw	word_1071
FFD4: 0E0F94  		.db	$e,$f,$94
              	; RANDOM
FFD7: 80      		.db	$80
FFD8: 31C5    		.dw	word_1072
FFDA: 12010E04		.db	$12,$1,$e,$4,$f,$8d
FFDE: 0F8D    	
              	; IM.DRAW
FFE0: 80      		.db	$80
FFE1: 51C5    		.dw	word_1073
FFE3: 090D2E04		.db	$9,$d,$2e,$4,$12,$1,$97
FFE7: 120197  	
              	; SG.DRAW
FFEA: 80      		.db	$80
FFEB: 65C5    		.dw	word_1074
FFED: 13072E04		.db	$13,$7,$2e,$4,$12,$1,$97
FFF1: 120197  	
              	; SG.ERASE
FFF4: 80      		.db	$80
FFF5: 80C5    		.dw	word_1075
FFF7: 13072E05		.db	$13,$7,$2e,$5,$12,$1,$13,$85
FFFB: 12011385	
FFFF: 00      		.db	$00


total time: 0.0107 sec.
no errors
